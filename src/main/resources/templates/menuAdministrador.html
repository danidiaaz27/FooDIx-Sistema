<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Panel de Administrador - FoodIx</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/modern-theme.css}">
    <style>
        .hover-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2) !important;
            border-color: var(--bs-primary);
        }
        
        .hover-card .fa-4x {
            transition: all 0.3s ease;
        }
        
        .hover-card:hover .fa-4x {
            transform: scale(1.1);
        }
    </style>
    <script>
    // Funcion GLOBAL para cambiar secciones - DEFINIDA ANTES DE CARGAR EL BODY
    function showSection(sectionName) {
        console.log('>>> Cambiando a seccion:', sectionName);
        
        // Ocultar todas las secciones
        var sections = document.querySelectorAll('.menu-section');
        sections.forEach(function(section) {
            section.classList.remove('active');
        });
        
        // Mostrar la sección seleccionada
        var targetSection = document.getElementById(sectionName + '-content');
        if (targetSection) {
            targetSection.classList.add('active');
            console.log('Sección mostrada:', sectionName + '-content');
        } else {
            console.error('No se encontró la sección:', sectionName + '-content');
        }
        
        // Actualizar links activos en el sidebar
        var links = document.querySelectorAll('.sidebar .nav-link');
        links.forEach(function(link) {
            link.classList.remove('active');
            if (link.getAttribute('data-section') === sectionName) {
                link.classList.add('active');
            }
        });
    }
    </script>
</head>
<body>

<!-- Barra de Navegación -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/" th:href="@{/}">FoodIx Admin</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="menuNav">
            <ul class="navbar-nav ms-auto">
                <!-- Botón de Tema Claro/Oscuro -->
                <li class="nav-item d-flex align-items-center">
                    <button class="theme-toggle" type="button" aria-label="Cambiar tema">
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                    </button>
                </li>
                <li class="nav-item">
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-shield"></i> <span>Administrador</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <form th:action="@{/logout}" method="post" style="display: inline; margin: 0;">
                                    <button type="submit" class="dropdown-item" style="border: none; background: none; cursor: pointer; width: 100%; text-align: left;">
                                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesion
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Mensajes Flash como Modales -->
<!-- <div th:replace="fragments/flash-messages :: flashMessages"></div> -->

<!-- Contenido Principal -->
<main class="container-fluid" style="padding-top: 90px;">

    <div class="row">
        <!-- Sidebar de navegación -->
        <div class="col-md-3 col-lg-2 sidebar">
            <div class="sidebar-content">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-shield fa-3x"></i>
                    </div>
                    <h5>Administrador</h5>
                </div>

                <ul class="nav nav-pills flex-column">
                    <!-- Gestion de Clientes - Solo si tiene permiso 'clientes' -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('usuarios')" data-section="usuarios">
                            <i class="fas fa-users"></i> Gestión de Clientes
                        </a>
                    </li>
                    
                    <!-- Restaurantes - Solo si tiene permiso 'restaurantes' -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('restaurantes')" data-section="restaurantes">
                            <i class="fas fa-store"></i> Restaurantes
                        </a>
                    </li>
                    
                    <!-- Repartidores - Solo si tiene permiso 'delivery' -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('delivery')" data-section="delivery">
                            <i class="fas fa-motorcycle"></i> Repartidores
                        </a>
                    </li>
                    
                    <!-- Reportes - Visible para todos (o agregar permiso específico) -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('reportes')" data-section="reportes">
                            <i class="fas fa-chart-bar"></i> Reportes
                        </a>
                    </li>
                    
                    <!-- Configuración - Solo si tiene permiso 'configuracion' -->
                    <li class="nav-item" th:if="${permisosUsuario.contains('configuracion')}">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('configuracion')" data-section="configuracion">
                            <i class="fas fa-cog"></i> Configuración
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="col-md-9 col-lg-10 main-content">
            <!-- Sección Usuarios/Clientes - Solo si tiene permiso -->
            <section id="usuarios-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Gestión de Clientes</h2>
                    <p class="text-muted">Administra los clientes de la plataforma</p>
                </div>

                <!-- Filtros de búsqueda en tiempo real -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filtros</h5>
                        <form onsubmit="return false" class="row g-3">
                            <div class="col-md-4">
                                <label for="filterClienteName" class="form-label"><i class="fas fa-search"></i> Buscar por Nombre</label>
                                <input type="text" class="form-control" id="filterClienteName" name="clienteName" 
                                       placeholder="Ingrese nombre o apellido...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterClienteDni" class="form-label"><i class="fas fa-id-card"></i> DNI</label>
                                <input type="text" class="form-control" id="filterClienteDni" name="clienteDni" 
                                       placeholder="Número de documento...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterClienteEstado" class="form-label"><i class="fas fa-toggle-on"></i> Estado</label>
                                <select class="form-select" id="filterClienteEstado" name="clienteEstado">
                                    <option value="">Todos</option>
                                    <option value="true">Activos</option>
                                    <option value="false">Inactivos</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Tabla de clientes -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>DNI</th>
                                        <th>Teléfono</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="user : ${clientes}">
                                        <td th:text="${user.codigo}">1</td>
                                        <td th:text="${user.nombreCompleto}">John Doe</td>
                                        <td th:text="${user.numeroDocumento != null ? user.numeroDocumento : 'N/A'}">12345678</td>
                                        <td th:text="${user.telefono != null ? user.telefono : 'N/A'}">999999999</td>
                                        <td>
                                            <span th:class="${user.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${user.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td>
                                            <!-- Botón Ver Detalles -->
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#viewClientModal"
                                                    th:data-id="${user.codigo}"
                                                    th:data-name="${user.nombreCompleto}"
                                                    th:data-email="${user.correoElectronico}"
                                                    th:data-dni="${user.numeroDocumento}"
                                                    th:data-phone="${user.telefono}"
                                                    th:data-address="${user.direccion}"
                                                    title="Ver detalles">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            
                                            <!-- Botón Modificar -->
                                            <button type="button" class="btn btn-sm btn-info" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#editUserModal"
                                                    th:data-id="${user.codigo}"
                                                    th:data-name="${user.nombre}"
                                                    th:data-lastname="${user.apellidoPaterno + ' ' + user.apellidoMaterno}"
                                                    th:data-email="${user.correoElectronico}"
                                                    th:data-phone="${user.telefono}"
                                                    th:data-address="${user.direccion}"
                                                    title="Modificar">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            
                                            <!-- Botón Cambiar Estado -->
                                            <form th:action="@{/menuAdministrador/user/{id}/toggle-status(id=${user.codigo})}" 
                                                  method="post" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-warning" 
                                                        th:title="${user.estado ? 'Desactivar' : 'Activar'}">
                                                    <i th:class="${user.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                </button>
                                            </form>
                                            
                                            <!-- Botón Eliminar -->
                                            <form th:action="@{/menuAdministrador/user/{id}/delete(id=${user.codigo})}" 
                                                  method="post" style="display: inline;"
                                                  onsubmit="return confirm('¿Está seguro de eliminar este cliente?');">
                                                <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <a href="/api/export/usuarios" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> Exportar a Excel
                        </a>
                    </div>
                </div>
            </section>

            <!-- Sección Restaurantes - Solo si tiene permiso -->
            <section id="restaurantes-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-store"></i> Gestión de Restaurantes</h2>
                    <p class="text-muted">Administra los restaurantes asociados</p>
                </div>

                <!-- Filtros de búsqueda en tiempo real -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filtros</h5>
                        <form onsubmit="return false" class="row g-3">
                            <div class="col-md-4">
                                <label for="filterRestaurantName" class="form-label"><i class="fas fa-search"></i> Buscar por Nombre</label>
                                <input type="text" class="form-control" id="filterRestaurantName" name="restaurantName" 
                                       placeholder="Nombre comercial o razón social...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterRestaurantRuc" class="form-label"><i class="fas fa-id-card"></i> RUC</label>
                                <input type="text" class="form-control" id="filterRestaurantRuc" name="restaurantRuc" 
                                       placeholder="Número de RUC...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterRestaurantEstado" class="form-label"><i class="fas fa-check-circle"></i> Estado</label>
                                <select class="form-select" id="filterRestaurantEstado" name="restaurantEstado">
                                    <option value="">Todos</option>
                                    <option value="PENDING">Pendientes</option>
                                    <option value="APPROVED">Aprobados</option>
                                    <option value="REJECTED">Rechazados</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Lista de restaurantes-->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 5%;">ID</th>
                                        <th style="width: 25%;">Nombre Comercial</th>
                                        <th style="width: 15%;">RUC</th>
                                        <th style="width: 20%;">Email</th>
                                        <th style="width: 10%;" class="text-center">Estado</th>
                                        <th style="width: 25%;" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Restaurantes Pendientes -->
                                    <tr th:if="${pendingRestaurants != null and !pendingRestaurants.isEmpty()}" 
                                        class="table-warning">
                                        <td colspan="6" class="text-center fw-bold py-3">
                                            <i class="fas fa-clock fa-lg"></i> RESTAURANTES PENDIENTES DE APROBACIÃ“N
                                        </td>
                                    </tr>
                                    <tr th:each="restaurant : ${pendingRestaurants}">
                                        <td class="fw-bold" th:text="${restaurant.codigo}">1</td>
                                        <td>
                                            <div class="fw-bold" th:text="${restaurant.nombre}">Restaurante A</div>
                                            <small class="text-muted" th:text="${restaurant.razonSocial}">Razon Social</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${restaurant.ruc}">20131312955</span>
                                        </td>
                                        <td>
                                            <small th:text="${restaurant.correoElectronico}">restaurante@example.com</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-warning text-dark px-3 py-2">
                                                <i class="fas fa-clock"></i> Pendiente
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <!-- Botón Ver Detalles -->
                                                <button type="button" class="btn btn-sm btn-info" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#viewRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        th:data-razon="${restaurant.razonSocial}"
                                                        th:data-ruc="${restaurant.ruc}"
                                                        th:data-email="${restaurant.correoElectronico}"
                                                        th:data-telefono="${restaurant.telefono}"
                                                        th:data-direccion="${restaurant.direccion}"
                                                        title="Ver Detalles y Documentos">
                                                    <i class="fas fa-eye"></i> Ver
                                                </button>

                                                <!-- Botón Aprobar -->
                                                <button type="button" class="btn btn-sm btn-success" 
                                                        onclick="aprobarRestaurante(this)"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        title="Aprobar Restaurante">
                                                    <i class="fas fa-check"></i> Aprobar
                                                </button>
                                                
                                                <!-- Botón Rechazar -->
                                                <button type="button" class="btn btn-sm btn-danger" 
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#rejectRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        title="Rechazar Restaurante">
                                                    <i class="fas fa-times"></i> Rechazar
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- Restaurantes Aprobados -->
                                    <tr th:if="${approvedRestaurants != null and !approvedRestaurants.isEmpty()}" 
                                        class="table-success">
                                        <td colspan="6" class="text-center fw-bold py-3">
                                            <i class="fas fa-check-circle fa-lg"></i> RESTAURANTES APROBADOS
                                        </td>
                                    </tr>
                                    <tr th:each="restaurant : ${approvedRestaurants}">
                                        <td class="fw-bold" th:text="${restaurant.codigo}">1</td>
                                        <td>
                                            <div class="fw-bold" th:text="${restaurant.nombre}">Restaurante B</div>
                                            <small class="text-muted" th:text="${restaurant.razonSocial}">Razon Social</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${restaurant.ruc}">20131312955</span>
                                        </td>
                                        <td>
                                            <small th:text="${restaurant.correoElectronico}">restaurante@example.com</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-success px-3 py-2">
                                                <i class="fas fa-check-circle"></i> Aprobado
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <!-- Botón Ver Detalles -->
                                                <button type="button" class="btn btn-sm btn-info" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#viewRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        th:data-razon="${restaurant.razonSocial}"
                                                        th:data-ruc="${restaurant.ruc}"
                                                        th:data-email="${restaurant.correoElectronico}"
                                                        th:data-telefono="${restaurant.telefono}"
                                                        th:data-direccion="${restaurant.direccion}"
                                                        title="Ver Detalles">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                
                                                <!-- Botón Cambiar Estado -->
                                                <button type="button" class="btn btn-sm btn-warning" 
                                                        onclick="toggleEstadoRestaurante(this)"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-estado="${restaurant.estado}"
                                                        title="Activar/Desactivar">
                                                    <i class="fas fa-toggle-on"></i>
                                                </button>
                                                
                                                <!-- Botón Eliminar -->
                                                <button type="button" class="btn btn-sm btn-danger" 
                                                        onclick="eliminarRestaurante(this)"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- Mensaje si no hay restaurantes -->
                                    <tr th:if="${(pendingRestaurants == null or pendingRestaurants.isEmpty()) and (approvedRestaurants == null or approvedRestaurants.isEmpty())}">
                                        <td colspan="6" class="text-center text-muted">
                                            <i class="fas fa-info-circle"></i> No hay restaurantes registrados
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <a href="/api/export/restaurantes" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> Exportar a Excel
                        </a>
                    </div>
                </div>
            </section>

            <!-- Sección Delivery - Solo si tiene permiso -->
            <section id="delivery-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-motorcycle"></i> Gestión de Repartidores</h2>
                    <p class="text-muted">Administra los repartidores de la plataforma</p>
                </div>

                <!-- Filtros de búsqueda en tiempo real -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filtros</h5>
                        <form onsubmit="return false" class="row g-3">
                            <div class="col-md-4">
                                <label for="filterDeliveryName" class="form-label"><i class="fas fa-search"></i> Buscar por Nombre</label>
                                <input type="text" class="form-control" id="filterDeliveryName" name="deliveryName" 
                                       placeholder="Ingrese nombre o apellido...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterDeliveryEmail" class="form-label"><i class="fas fa-envelope"></i> Email</label>
                                <input type="email" class="form-control" id="filterDeliveryEmail" name="deliveryEmail" 
                                       placeholder="email@ejemplo.com">
                            </div>
                            <div class="col-md-3">
                                <label for="filterDeliveryEstado" class="form-label"><i class="fas fa-check-circle"></i> Estado Aprobacion</label>
                                <select class="form-select" id="filterDeliveryEstado" name="deliveryEstado">
                                    <option value="">Todos</option>
                                    <option value="PENDING">Pendientes</option>
                                    <option value="APPROVED">Aprobados</option>
                                    <option value="REJECTED">Rechazados</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Lista de repartidores (usuarios con rol DELIVERY) -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Teléfono</th>
                                        <th>Licencia</th>
                                        <th>Estado Aprobacion</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="delivery : ${repartidores}">
                                        <td th:text="${delivery.codigo}">1</td>
                                        <td th:text="${delivery.usuario != null ? delivery.usuario.nombreCompleto : 'N/A'}">Juan Pérez</td>
                                        <td th:text="${delivery.usuario != null ? delivery.usuario.correoElectronico : 'N/A'}">delivery@example.com</td>
                                        <td th:text="${delivery.usuario != null and delivery.usuario.telefono != null ? delivery.usuario.telefono : 'N/A'}">999999999</td>
                                        <td th:text="${delivery.numeroLicencia}">ABC123456</td>
                                        <td>
                                            <span th:if="${delivery.codigoEstadoAprobacion == 7}" class="badge bg-warning text-dark">Pendiente</span>
                                            <span th:if="${delivery.codigoEstadoAprobacion == 8}" class="badge bg-success">Aprobado</span>
                                            <span th:if="${delivery.codigoEstadoAprobacion == 9}" class="badge bg-danger">Rechazado</span>
                                        </td>
                                        <td>
                                            <span th:class="${delivery.estado != null and delivery.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${delivery.estado != null and delivery.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td>
                                            <!-- Botones para PENDIENTE -->
                                            <div th:if="${delivery.codigoEstadoAprobacion == 7}">
                                                <form th:action="@{/menuAdministrador/delivery/{id}/approve(id=${delivery.codigo})}" 
                                                      method="post" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-success" title="Aprobar">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                </form>
                                                <form th:action="@{/menuAdministrador/delivery/{id}/reject(id=${delivery.codigo})}" 
                                                      method="post" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-danger" title="Rechazar">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            
                                            <!-- Botones para APROBADO -->
                                            <div th:if="${delivery.codigoEstadoAprobacion == 8}">
                                                <button type="button" class="btn btn-sm btn-info" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#editDeliveryModal"
                                                        th:data-id="${delivery.codigo}"
                                                        th:data-name="${delivery.usuario != null ? delivery.usuario.nombre : ''}"
                                                        th:data-lastname="${delivery.usuario != null ? (delivery.usuario.apellidoPaterno + ' ' + delivery.usuario.apellidoMaterno) : ''}"
                                                        th:data-email="${delivery.usuario != null ? delivery.usuario.correoElectronico : ''}"
                                                        th:data-phone="${delivery.usuario != null ? delivery.usuario.telefono : ''}"
                                                        th:data-address="${delivery.usuario != null ? delivery.usuario.direccion : ''}"
                                                        title="Modificar">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                
                                                <form th:action="@{/menuAdministrador/delivery/{id}/toggle-status(id=${delivery.codigo})}" 
                                                      method="post" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-warning" 
                                                            th:title="${delivery.estado ? 'Desactivar' : 'Activar'}">
                                                        <i th:class="${delivery.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                    </button>
                                                </form>
                                                
                                                <form th:action="@{/menuAdministrador/delivery/{id}/delete(id=${delivery.codigo})}" 
                                                      method="post" style="display: inline;"
                                                      onsubmit="return confirm('¿Está seguro de eliminar este repartidor?');">
                                                    <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            
                                            <!-- Botones para RECHAZADO -->
                                            <div th:if="${delivery.codigoEstadoAprobacion == 9}">
                                                <form th:action="@{/menuAdministrador/delivery/{id}/delete(id=${delivery.codigo})}" 
                                                      method="post" style="display: inline;"
                                                      onsubmit="return confirm('¿Está seguro de eliminar este repartidor rechazado?');">
                                                    <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <a href="/api/export/delivery" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> Exportar a Excel
                        </a>
                    </div>
                </div>
            </section>

            <!-- Sección Reportes -->
            <section id="reportes-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Reportes y Estadísticas</h2>
                    <p class="text-muted">Visualiza las estadísticas de la plataforma</p>
                </div>

                <!-- Tarjetas de resumen -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h5>Usuarios Totales</h5>
                                <h3 th:text="${stats != null and stats.totalUsers != null ? stats.totalUsers : 0}">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h5>Ventas del Mes</h5>
                                <h3 th:text="${stats != null and stats.monthSales != null ? stats.monthSales : 0}">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-white">
                            <div class="card-body">
                                <h5>Pedidos Activos</h5>
                                <h3 th:text="${stats != null and stats.activeOrders != null ? stats.activeOrders : 0}">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h5>Restaurantes</h5>
                                <h3 th:text="${stats != null and stats.totalRestaurants != null ? stats.totalRestaurants : 0}">0</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sección Configuración - Solo si tiene permiso -->
            <section id="configuracion-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-cog"></i> Configuración del Sistema</h2>
                    <p class="text-muted">Administra la configuración general de la plataforma</p>
                </div>

                <div class="row g-4">
                    <!-- Tarjeta Categorías -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-tags fa-4x text-primary"></i>
                                </div>
                                <h5 class="card-title">Categorías</h5>
                                <p class="card-text text-muted">Gestiona las categorías de restaurantes y productos</p>
                                <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#manageCategoriesModal">
                                    <i class="fas fa-cog"></i> Gestionar Categorías
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tarjeta Administradores -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-users-cog fa-4x text-success"></i>
                                </div>
                                <h5 class="card-title">Administradores</h5>
                                <p class="card-text text-muted">Administra los usuarios con rol de administrador</p>
                                <button type="button" class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#manageAdminsModal">
                                    <i class="fas fa-cog"></i> Gestionar Usuarios del Sistema
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tarjeta Roles -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-user-tag fa-4x text-warning"></i>
                                </div>
                                <h5 class="card-title">Roles</h5>
                                <p class="card-text text-muted">Visualiza y gestiona los roles del sistema</p>
                                <button type="button" class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#manageRolesModal">
                                    <i class="fas fa-cog"></i> Ver Roles
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- Modal para editar usuario -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel"><i class="fas fa-user-edit"></i> Modificar Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editUserForm" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editUserName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editUserName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editUserLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editUserEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserPhone" class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="editUserPhone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label for="editUserAddress" class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="editUserAddress" name="address">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para ver detalles del cliente -->
<div class="modal fade" id="viewClientModal" tabindex="-1" aria-labelledby="viewClientModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="viewClientModalLabel">
                    <i class="fas fa-user"></i> Detalles del Cliente
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Información del Cliente -->
                <div class="row mb-3">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-info-circle text-primary"></i> Información Personal
                        </h5>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Nombre Completo:</dt>
                            <dd class="col-sm-7 fw-bold" id="viewClientName">-</dd>
                            
                            <dt class="col-sm-5">DNI:</dt>
                            <dd class="col-sm-7">
                                <span class="badge bg-secondary" id="viewClientDni">-</span>
                            </dd>
                            
                            <dt class="col-sm-5">Email:</dt>
                            <dd class="col-sm-7" id="viewClientEmail">-</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Teléfono:</dt>
                            <dd class="col-sm-7" id="viewClientPhone">-</dd>
                            
                            <dt class="col-sm-5">Dirección:</dt>
                            <dd class="col-sm-7" id="viewClientAddress">-</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para editar repartidor -->
<div class="modal fade" id="editDeliveryModal" tabindex="-1" aria-labelledby="editDeliveryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDeliveryModalLabel"><i class="fas fa-motorcycle"></i> Modificar Repartidor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editDeliveryForm" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editDeliveryName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editDeliveryName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editDeliveryLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editDeliveryEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryPhone" class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="editDeliveryPhone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryAddress" class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="editDeliveryAddress" name="address">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para ver detalles del restaurante -->
<div class="modal fade" id="viewRestaurantModal" tabindex="-1" aria-labelledby="viewRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="viewRestaurantModalLabel">
                    <i class="fas fa-store"></i> Detalles del Restaurante
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Información General -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-info-circle text-primary"></i> Información General
                        </h5>   
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Nombre Comercial:</dt>
                            <dd class="col-sm-7 fw-bold" id="viewRestaurantNombre">-</dd>
                            
                            <dt class="col-sm-5">Razón Social:</dt>
                            <dd class="col-sm-7" id="viewRestaurantRazon">-</dd>
                            
                            <dt class="col-sm-5">RUC:</dt>
                            <dd class="col-sm-7">
                                <span class="badge bg-secondary" id="viewRestaurantRuc">-</span>
                            </dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Email:</dt>
                            <dd class="col-sm-7" id="viewRestaurantEmail">-</dd>
                            
                            <dt class="col-sm-5">Teléfono:</dt>
                            <dd class="col-sm-7" id="viewRestaurantTelefono">-</dd>
                            
                            <dt class="col-sm-5">Dirección:</dt>
                            <dd class="col-sm-7" id="viewRestaurantDireccion">-</dd>
                        </dl>
                    </div>
                </div>
                
                <!-- Documentos -->
                <div class="row">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-file-alt text-success"></i> Documentos de Verificación
                        </h5>
                    </div>
                </div>
                
                <div class="row g-3">
                    <!-- Carta del Restaurante -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-utensils fa-3x text-warning mb-3"></i>
                                <h6 class="card-title">Carta del Restaurante</h6>
                                <p class="card-text text-muted small">Menú y oferta gastronómica</p>
                                <button type="button" class="btn btn-sm btn-outline-primary w-100" 
                                        onclick="verDocumento('CARTA_RESTAURANTE', document.getElementById('viewRestaurantModal').dataset.restaurantId)">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carnet de Sanidad -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-notes-medical fa-3x text-success mb-3"></i>
                                <h6 class="card-title">Carnet de Sanidad</h6>
                                <p class="card-text text-muted small">Certificado sanitario vigente</p>
                                <button type="button" class="btn btn-sm btn-outline-primary w-100" 
                                        onclick="verDocumento('CarnetSanidad', document.getElementById('viewRestaurantModal').dataset.restaurantId)">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Licencia de Funcionamiento -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-certificate fa-3x text-info mb-3"></i>
                                <h6 class="card-title">Licencia de Funcionamiento</h6>
                                <p class="card-text text-muted small">Autorización municipal</p>
                                <button type="button" class="btn btn-sm btn-outline-primary w-100" 
                                        onclick="verDocumento('LicenciaFuncionamiento', document.getElementById('viewRestaurantModal').dataset.restaurantId)">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Nota:</strong> Todos los documentos son obligatorios para la aprobación del restaurante. 
                    Verifica que estén completos y actualizados antes de aprobar.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para rechazar restaurante -->
<div class="modal fade" id="rejectRestaurantModal" tabindex="-1" aria-labelledby="rejectRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="rejectRestaurantModalLabel"><i class="fas fa-times-circle"></i> Rechazar Restaurante</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="rejectRestaurantForm" method="post">
                <div class="modal-body">
                    <input type="hidden" name="section" value="restaurantes">
                    <p>¿Está seguro de rechazar el restaurante <strong id="rejectRestaurantNombre"></strong>?</p>
                    <div class="mb-3">
                        <label for="motivoRechazo" class="form-label">Motivo del Rechazo <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="motivoRechazo" name="motivo" rows="4" 
                                  placeholder="Explique el motivo del rechazo (mínimo 10 caracteres)" 
                                  required minlength="10"></textarea>
                        <div class="form-text">Este motivo será visible para el restaurante.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger"><i class="fas fa-times"></i> Rechazar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para editar restaurante -->
<div class="modal fade" id="editRestaurantModal" tabindex="-1" aria-labelledby="editRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editRestaurantModalLabel"><i class="fas fa-edit"></i> Modificar Restaurante</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editRestaurantForm" method="post">
                <div class="modal-body">
                    <input type="hidden" id="editRestaurantId" name="id">
                    <div class="mb-3">
                        <label for="editRestaurantName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editRestaurantName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRestaurantLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editRestaurantLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRestaurantEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editRestaurantEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRestaurantPhone" class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="editRestaurantPhone" name="phone">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para gestionar categorías -->
<div class="modal fade" id="manageCategoriesModal" tabindex="-1" aria-labelledby="manageCategoriesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="manageCategoriesModalLabel">
                    <i class="fas fa-tags"></i> Gestión de Categorías
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Formulario para crear categoría -->
                    <div class="col-md-5">
                        <h6 class="mb-3"><i class="fas fa-plus-circle"></i> Crear Nueva Categoría</h6>
                        <form action="/menuAdministrador/create-category" th:action="@{/menuAdministrador/create-category}" method="post">
                            <div class="mb-3">
                                <label for="categoryName" class="form-label">Nombre de Categoría *</label>
                                <input type="text" class="form-control" id="categoryName" name="nombre" required>
                            </div>
                            <div class="mb-3">
                                <label for="categoryDescription" class="form-label">Descripción</label>
                                <textarea class="form-control" id="categoryDescription" name="descripcion" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="categoryIcon" class="form-label">Icono (FontAwesome)</label>
                                <input type="text" class="form-control" id="categoryIcon" name="icono" placeholder="fa-utensils">
                                <small class="text-muted">Ejemplo: fa-utensils, fa-pizza-slice, fa-fish, fa-hamburger</small>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-plus"></i> Crear Categoría
                            </button>
                        </form>
                    </div>
                    
                    <!-- Lista de categorías existentes -->
                    <div class="col-md-7">
                        <h6 class="mb-3"><i class="fas fa-list"></i> Categorías Existentes</h6>
                        <div class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>Icono</th>
                                        <th>Nombre</th>
                                        <th>Descripción</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="category : ${categories}">
                                        <td><i th:class="'fas ' + ${category.icono} + ' fa-lg'"></i></td>
                                        <td><strong th:text="${category.nombre}">Pollería</strong></td>
                                        <td><small th:text="${category.descripcion}">Descripción</small></td>
                                        <td>
                                            <span th:class="${category.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${category.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td>
                                            <form th:action="@{/menuAdministrador/category/{id}/toggle-status(id=${category.codigo})}" 
                                                  method="post" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-warning" title="Cambiar Estado">
                                                    <i class="fas fa-toggle-on"></i>
                                                </button>
                                            </form>
                                            <form th:action="@{/menuAdministrador/category/{id}/delete(id=${category.codigo})}" 
                                                  method="post" style="display: inline;"
                                                  onsubmit="return confirm('¿Está seguro de eliminar esta categoría?');">
                                                <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para gestionar administradores -->
<div class="modal fade" id="manageAdminsModal" tabindex="-1" aria-labelledby="manageAdminsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="manageAdminsModalLabel">
                    <i class="fas fa-users-cog"></i> Gestión de Usuarios del Sistema
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Formulario para crear administrador -->
                    <div class="col-md-5">
                        <h6 class="mb-3"><i class="fas fa-user-plus"></i> Crear Nuevo Usuario</h6>
                        <form action="/menuAdministrador/create-admin" th:action="@{/menuAdministrador/create-admin}" method="post">
                            <div class="mb-3">
                                <label for="adminName" class="form-label">Nombre *</label>
                                <input type="text" class="form-control" id="adminName" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="adminLastName" class="form-label">Apellido *</label>
                                <input type="text" class="form-control" id="adminLastName" name="lastName" required>
                            </div>
                            <div class="mb-3">
                                <label for="adminEmail" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="adminEmail" name="email" required>
                            </div>
                            
                            <!-- Selector de Rol -->
                            <div class="mb-3">
                                <label for="adminRol" class="form-label"><i class="fas fa-user-tag"></i> Rol *</label>
                                <select class="form-select" id="adminRol" name="codigoRol" required>
                                    <option value="">-- Selecciona un rol --</option>
                                    <option th:each="rol : ${roles}" 
                                            th:if="${rol.estado}"
                                            th:value="${rol.codigo}" 
                                            th:text="${rol.nombre + ' - ' + rol.descripcion}"
                                            th:data-rol-codigo="${rol.codigo}"
                                            th:data-rol-nombre="${rol.nombre}">
                                        Rol
                                    </option>
                                </select>
                                <small class="text-muted">Define los permisos del usuario en el sistema</small>
                                <div id="rolHelp" class="form-text mt-1"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="adminPassword" class="form-label">Contraseña *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="adminPassword" name="password" minlength="8" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('adminPassword', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <!-- El mensaje de requisitos se generará dinámicamente por JavaScript -->
                            </div>
                            <div class="mb-3">
                                <label for="adminPasswordConfirm" class="form-label">Confirmar Contraseña *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="adminPasswordConfirm" name="passwordConfirm" minlength="8" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('adminPasswordConfirm', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <!-- El mensaje de coincidencia se generará dinámicamente por JavaScript -->
                            </div>
                            <div class="mb-3">
                                <label for="adminPhone" class="form-label">Teléfono</label>
                                <input type="text" class="form-control" id="adminPhone" name="phone">
                            </div>
                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-user-plus"></i> Crear Usuario
                            </button>
                        </form>
                    </div>
                    
                    <!-- Lista de administradores existentes -->
                    <div class="col-md-7">
                        <h6 class="mb-3"><i class="fas fa-list"></i> Usuarios del Sistema Registrados</h6>
                        <div class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre Completo</th>
                                        <th>Email</th>
                                        <th>Teléfono</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="admin : ${adminUsers}">
                                        <td th:text="${admin.codigo}">1</td>
                                        <td><strong th:text="${admin.nombreCompleto}">Admin User</strong></td>
                                        <td th:text="${admin.correoElectronico}">admin@example.com</td>
                                        <td th:text="${admin.telefono != null ? admin.telefono : 'N/A'}">999999999</td>
                                        <td>
                                            <span th:class="${admin.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${admin.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para gestionar roles del sistema -->
<div class="modal fade" id="manageRolesModal" tabindex="-1" aria-labelledby="manageRolesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="manageRolesModalLabel">
                    <i class="fas fa-user-shield me-2"></i> Gestión de Roles del Sistema
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row g-4">
                    <!-- Formulario para crear rol -->
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-plus-circle me-2"></i> Crear Nuevo Rol</h6>
                            </div>
                            <div class="card-body">
                                <form action="/menuAdministrador/role/create" th:action="@{/menuAdministrador/role/create}" method="post">
                                    <div class="mb-3">
                                        <label for="rolNombre" class="form-label fw-bold">
                                            <i class="fas fa-tag text-primary me-1"></i> Nombre del Rol *
                                        </label>
                                        <input type="text" class="form-control" id="rolNombre" name="nombre" 
                                               placeholder="Ej: Supervisor, Gerente..." required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="rolDescripcion" class="form-label fw-bold">
                                            <i class="fas fa-align-left text-primary me-1"></i> Descripción
                                        </label>
                                        <textarea class="form-control" id="rolDescripcion" name="descripcion" rows="2" 
                                                  placeholder="Describe las funciones de este rol..."></textarea>
                                    </div>
                                    
                                    <!-- Permisos del rol -->
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">
                                            <i class="fas fa-shield-alt text-success me-1"></i> Permisos de Acceso
                                        </label>
                                        <button type="button" class="btn btn-outline-primary w-100" onclick="abrirModalSeleccionPermisos()">
                                            <i class="fas fa-list-check me-2"></i>
                                            Seleccionar Permisos
                                            <span class="badge bg-primary ms-2" id="countPermisos">0</span>
                                        </button>
                                        <div id="selectedPermisosDisplay" class="mt-2 p-2 border rounded bg-light" style="min-height: 60px; max-height: 150px; overflow-y: auto;">
                                            <small class="text-muted">No hay permisos seleccionados</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Inputs ocultos para los permisos seleccionados -->
                                    <div id="hiddenPermisosContainer"></div>
                                    
                                    <button type="submit" class="btn btn-primary w-100 fw-bold">
                                        <i class="fas fa-plus me-2"></i> Crear Rol
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal para seleccionar permisos -->
                    <div class="modal fade" id="selectPermisosModal" tabindex="-1" aria-labelledby="selectPermisosModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="selectPermisosModalLabel">
                                        <i class="fas fa-shield-alt me-2"></i> Configurar Permisos del Rol
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" onclick="cerrarModalSeleccionPermisos()" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                                    
                                    <!-- Usuarios -->
                                    <div class="card mb-3 border-primary" th:if="${permisos.?[seccion == 'usuarios'].size() > 0}">
                                        <div class="card-header bg-primary bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllUsuarios" data-section="usuarios">
                                                <label class="form-check-label fw-bold text-primary" for="selectAllUsuarios">
                                                    <i class="fas fa-users-cog me-2"></i> Usuarios del Sistema
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'usuarios']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="usuarios">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-info me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripción</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Clientes -->
                                    <div class="card mb-3 border-success" th:if="${permisos.?[seccion == 'clientes'].size() > 0}">
                                        <div class="card-header bg-success bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllClientes" data-section="clientes">
                                                <label class="form-check-label fw-bold text-success" for="selectAllClientes">
                                                    <i class="fas fa-user-friends me-2"></i> Clientes
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'clientes']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="clientes">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-success me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripción</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Restaurantes -->
                                    <div class="card mb-3 border-warning" th:if="${permisos.?[seccion == 'restaurantes'].size() > 0}">
                                        <div class="card-header bg-warning bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllRestaurantes" data-section="restaurantes">
                                                <label class="form-check-label fw-bold text-warning" for="selectAllRestaurantes">
                                                    <i class="fas fa-utensils me-2"></i> Restaurantes
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'restaurantes']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="restaurantes">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-warning text-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripción</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Delivery -->
                                    <div class="card mb-3 border-danger" th:if="${permisos.?[seccion == 'delivery'].size() > 0}">
                                        <div class="card-header bg-danger bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllDelivery" data-section="delivery">
                                                <label class="form-check-label fw-bold text-danger" for="selectAllDelivery">
                                                    <i class="fas fa-motorcycle me-2"></i> Repartidores
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'delivery']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="delivery">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-danger me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripción</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Categorías -->
                                    <div class="card mb-3 border-secondary" th:if="${permisos.?[seccion == 'categorias'].size() > 0}">
                                        <div class="card-header bg-secondary bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllCategorias" data-section="categorias">
                                                <label class="form-check-label fw-bold text-secondary" for="selectAllCategorias">
                                                    <i class="fas fa-tags me-2"></i> Categorías
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'categorias']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="categorias">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-secondary me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripción</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Configuración -->
                                    <div class="card mb-3 border-dark" th:if="${permisos.?[seccion == 'configuracion'].size() > 0}">
                                        <div class="card-header bg-dark bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllConfiguracion" data-section="configuracion">
                                                <label class="form-check-label fw-bold text-dark" for="selectAllConfiguracion">
                                                    <i class="fas fa-cogs me-2"></i> Configuración
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'configuracion']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="configuracion">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripción</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="cerrarModalSeleccionPermisos()">
                                        <i class="fas fa-times me-2"></i> Cancelar
                                    </button>
                                    <button type="button" class="btn btn-primary" id="confirmPermisos" onclick="cerrarModalSeleccionPermisos()">
                                        <i class="fas fa-check me-2"></i> Confirmar Selección
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Continuar con el resto del modal de roles -->
                    
                    <!-- Lista de roles existentes -->
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-list-ul me-2"></i> Roles Registrados</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead style="background-color: #e9ecef;">
                                            <tr>
                                                <th class="text-center" style="width: 80px;">Código</th>
                                                <th>Nombre</th>
                                                <th>Descripción</th>
                                                <th class="text-center" style="width: 120px;">Permisos</th>
                                                <th class="text-center" style="width: 100px;">Estado</th>
                                                <th class="text-center" style="width: 200px;">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="rol : ${roles}">
                                                <td class="text-center">
                                                    <span class="badge rounded-pill bg-secondary fs-6" th:text="${rol.codigo}">1</span>
                                                </td>
                                                <td>
                                                    <strong class="text-primary" th:text="${rol.nombre}">ADMINISTRADOR</strong>
                                                </td>
                                                <td>
                                                    <small th:text="${rol.descripcion != null ? rol.descripcion : '-'}">Descripción</small>
                                                </td>
                                                <td class="text-center">
                                                    <button type="button" 
                                                            class="btn btn-sm btn-outline-primary view-permisos-btn"
                                                            onclick="verPermisosRolManual(this)"
                                                            th:data-rol-id="${rol.codigo}"
                                                            th:data-rol-nombre="${rol.nombre}"
                                                            th:if="${rol.permisos != null && !rol.permisos.isEmpty()}">
                                                        <i class="fas fa-shield-alt me-1"></i>
                                                        <span class="badge bg-primary rounded-pill" th:text="${rol.permisos.size()}">0</span>
                                                    </button>
                                                    <span th:if="${rol.permisos == null || rol.permisos.isEmpty()}" 
                                                          class="text-muted fst-italic">
                                                        <i class="fas fa-ban"></i>
                                                    </span>
                                                </td>
                                                <td class="text-center">
                                                    <span th:class="${rol.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                          th:text="${rol.estado ? 'Activo' : 'Inactivo'}">
                                                        Activo
                                                    </span>
                                                </td>
                                                <td class="text-center">
                                                    <div class="btn-group" role="group">
                                                        <!-- Botón Editar -->
                                                        <button type="button" class="btn btn-sm btn-outline-info" 
                                                                data-bs-toggle="modal" 
                                                                data-bs-target="#editRolModal"
                                                                th:data-id="${rol.codigo}"
                                                                th:data-nombre="${rol.nombre}"
                                                                th:data-descripcion="${rol.descripcion}"
                                                                th:onclick="'loadRolPermisos(' + ${rol.codigo} + ')'"
                                                                title="Editar">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        
                                                        <!-- Botón Cambiar Estado -->
                                                        <form th:action="@{/menuAdministrador/role/{id}/toggle-status(id=${rol.codigo})}" 
                                                              method="post" style="display: inline;">
                                                            <button type="submit" class="btn btn-sm btn-outline-warning" 
                                                                    th:title="${rol.estado ? 'Desactivar' : 'Activar'}">
                                                                <i th:class="${rol.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                            </button>
                                                        </form>
                                                        
                                                        <!-- Botón Eliminar (solo para roles personalizados) -->
                                                        <form th:if="${rol.codigo > 4}" 
                                                              th:action="@{/menuAdministrador/role/{id}/delete(id=${rol.codigo})}" 
                                                              method="post" style="display: inline;"
                                                              onsubmit="return confirm('¿Está seguro de eliminar este rol? Esta acción no se puede deshacer.');">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                    
                                                    <!-- Indicador de rol del sistema -->
                                                    <div th:if="${rol.codigo <= 4}" class="mt-1">
                                                        <span class="badge bg-primary" title="Rol del sistema protegido">
                                                            <i class="fas fa-lock me-1"></i> Sistema
                                                        </span>
                                                    </div>
                                                </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Nota informativa -->
                <div class="alert alert-info border-0 mt-3 mb-0" style="background-color: #d1ecf1;">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle fs-4 me-3 text-info"></i>
                        <div>
                            <strong>Nota Importante:</strong> Los roles del sistema (códigos 1-4) están protegidos y no se pueden eliminar. 
                            Solo puedes editar su descripción y permisos.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cerrar
                </button>       
            </div>
        </div>
    </div>
</div>

<!-- Modal para editar rol -->
<div class="modal fade" id="editRolModal" tabindex="-1" aria-labelledby="editRolModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="editRolModalLabel">
                    <i class="fas fa-edit me-2"></i> Editar Rol
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editRolForm" method="post">
                <div class="modal-body p-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editRolNombre" class="form-label fw-bold">
                                    <i class="fas fa-tag text-primary me-1"></i> Nombre del Rol *
                                </label>
                                <input type="text" class="form-control" id="editRolNombre" name="nombre" required>
                            </div>
                            <div class="mb-3">
                                <label for="editRolDescripcion" class="form-label fw-bold">
                                    <i class="fas fa-align-left text-primary me-1"></i> Descripción
                                </label>
                                <textarea class="form-control" id="editRolDescripcion" name="descripcion" rows="4" 
                                          placeholder="Actualiza la descripción del rol..."></textarea>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-shield-alt text-success me-1"></i> Permisos de Acceso
                                </label>
                                <button type="button" class="btn btn-outline-success w-100" data-bs-toggle="modal" data-bs-target="#editPermisosModal">
                                    <i class="fas fa-list-check me-2"></i>
                                    Modificar Permisos
                                    <span class="badge bg-success ms-2" id="editCountPermisos">0</span>
                                </button>
                                <div id="editSelectedPermisosDisplay" class="mt-2 p-2 border rounded bg-light" style="min-height: 60px; max-height: 200px; overflow-y: auto;">
                                    <small class="text-muted">No hay permisos seleccionados</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Inputs ocultos para los permisos seleccionados en edición -->
                    <div id="editHiddenPermisosContainer"></div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary fw-bold">
                        <i class="fas fa-save me-2"></i> Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para editar permisos del rol -->
<div class="modal fade" id="editPermisosModal" tabindex="-1" aria-labelledby="editPermisosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="editPermisosModalLabel">
                    <i class="fas fa-shield-alt me-2"></i> Editar Permisos del Rol
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                
                <!-- Usuarios -->
                <div class="card mb-3 border-primary" th:if="${permisos.?[seccion == 'usuarios'].size() > 0}">
                    <div class="card-header bg-primary bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllUsuarios" data-section="usuarios">
                            <label class="form-check-label fw-bold text-primary" for="editSelectAllUsuarios">
                                <i class="fas fa-users-cog me-2"></i> Usuarios del Sistema
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'usuarios']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="usuarios">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-info me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripción</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Clientes -->
                <div class="card mb-3 border-success" th:if="${permisos.?[seccion == 'clientes'].size() > 0}">
                    <div class="card-header bg-success bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllClientes" data-section="clientes">
                            <label class="form-check-label fw-bold text-success" for="editSelectAllClientes">
                                <i class="fas fa-user-friends me-2"></i> Clientes
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'clientes']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="clientes">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-success me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripción</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Restaurantes -->
                <div class="card mb-3 border-warning" th:if="${permisos.?[seccion == 'restaurantes'].size() > 0}">
                    <div class="card-header bg-warning bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllRestaurantes" data-section="restaurantes">
                            <label class="form-check-label fw-bold text-warning" for="editSelectAllRestaurantes">
                                <i class="fas fa-utensils me-2"></i> Restaurantes
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'restaurantes']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="restaurantes">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-warning text-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripción</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery -->
                <div class="card mb-3 border-danger" th:if="${permisos.?[seccion == 'delivery'].size() > 0}">
                    <div class="card-header bg-danger bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllDelivery" data-section="delivery">
                            <label class="form-check-label fw-bold text-danger" for="editSelectAllDelivery">
                                <i class="fas fa-motorcycle me-2"></i> Repartidores
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'delivery']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="delivery">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-danger me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripción</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Categorías -->
                <div class="card mb-3 border-secondary" th:if="${permisos.?[seccion == 'categorias'].size() > 0}">
                    <div class="card-header bg-secondary bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllCategorias" data-section="categorias">
                            <label class="form-check-label fw-bold text-secondary" for="editSelectAllCategorias">
                                <i class="fas fa-tags me-2"></i> Categorías
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'categorias']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="categorias">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-secondary me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripción</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Configuracion -->
                <div class="card mb-3 border-dark" th:if="${permisos.?[seccion == 'configuracion'].size() > 0}">
                    <div class="card-header bg-dark bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllConfiguracion" data-section="configuracion">
                            <label class="form-check-label fw-bold text-dark" for="editSelectAllConfiguracion">
                                <i class="fas fa-cogs me-2"></i> Configuración
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'configuracion']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="configuracion">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripción</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cancelar
                </button>
                <button type="button" class="btn btn-success" id="confirmEditPermisos" data-bs-dismiss="modal">
                    <i class="fas fa-check me-2"></i> Confirmar Cambios
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Continuacion de permisos ocultos antiguos eliminada -->
                
<!-- Cierre de modales antiguos de edicion -->

<!-- Modal para ver permisos de un rol -->
<div class="modal fade" id="viewPermisosModal" tabindex="-1" aria-labelledby="viewPermisosModalLabel" aria-hidden="true" style="z-index: 1060;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background-color: white; position: relative; z-index: 1061;">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="viewPermisosModalLabel">
                    <i class="fas fa-shield-alt me-2"></i> Permisos del Rol: <span id="viewRolNombre" class="fw-bold"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                <div id="permisosContent" class="row g-3">
                    <!-- Se llenará dinámicamente con JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cerrar
                </button>
                <button type="button" class="btn btn-success" id="editPermisosFromView">
                    <i class="fas fa-edit me-2"></i> Editar Permisos
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para listar categorías (antiguo - mantener por compatibilidad) -->
<div class="modal fade" id="categoryListModal" tabindex="-1" aria-labelledby="categoryListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="categoryListModalLabel"><i class="fas fa-tags"></i> Lista de Categorías</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Descripción</th>
                                <th>Icono</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="category : ${categories}">
                                <td th:text="${category.codigo}">1</td>
                                <td th:text="${category.nombre}">Pollería</td>
                                <td th:text="${category.descripcion}">Descripción</td>
                                <td><i th:class="'fas ' + ${category.icono}"></i> <span th:text="${category.icono}"></span></td>
                                <td>
                                    <span th:class="${category.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                          th:text="${category.estado ? 'Activo' : 'Inactivo'}">
                                        Activo
                                    </span>
                                </td>
                                <td>
                                    <form th:action="@{/menuAdministrador/category/{id}/toggle-status(id=${category.codigo})}" 
                                          method="post" style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-warning" title="Cambiar Estado">
                                            <i class="fas fa-toggle-on"></i>
                                        </button>
                                    </form>
                                    <form th:action="@{/menuAdministrador/category/{id}/delete(id=${category.codigo})}" 
                                          method="post" style="display: inline;"
                                          onsubmit="return confirm('¿Está seguro de eliminar esta categoría?');">
                                        <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/theme-toggle.js}"></script>

<!-- ========================================
     VARIABLES THYMELEAF (Solo lo necesario)
     ======================================== -->
<script th:inline="javascript">
/*<![CDATA[*/

// Configuración global con variables del servidor
window.ADMIN_CONFIG = {
    activeSection: /*[[${activeSection}]]*/ 'usuarios',
    permisos: /*[[${permisos}]]*/ []
};

// Mapear permisos para el sistema
try {
    var permisosFromServer = window.ADMIN_CONFIG.permisos;
    
    if (permisosFromServer && Array.isArray(permisosFromServer)) {
        window.todosLosPermisos = permisosFromServer.map(function(p) {
            return {
                codigo: p.codigo || 0,
                nombre: p.nombre || p.accion || 'Permiso',
                accion: p.accion || p.nombre || 'Permiso',
                descripcion: p.descripcion || '',
                seccion: p.seccion || 'general'
            };
        });
        console.log('Permisos cargados:', window.todosLosPermisos.length);
    } else {
        console.warn('No hay permisos disponibles del servidor');
        window.todosLosPermisos = [];
    }
} catch(error) {
    console.error(' Error procesando permisos:', error);
    window.todosLosPermisos = [];
}

/*]]>*/
</script>

<!-- ========================================
     SCRIPTS EXTERNOS (Funcionalidad modular)
     ======================================== -->
<script src="/js/admin.js"></script>
<script src="/js/admin-permisos.js"></script>
<script src="/js/admin-form-validation.js"></script>

</body>
</html>
