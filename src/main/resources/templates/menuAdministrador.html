<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Panel de Administrador - FoodIx</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/modern-theme.css}">
    <style>
        .hover-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2) !important;
            border-color: var(--bs-primary);
        }
        
        .hover-card .fa-4x {
            transition: all 0.3s ease;
        }
        
        .hover-card:hover .fa-4x {
            transform: scale(1.1);
        }

        /* Estilos para el modal de gesti√≥n de men√∫ */
        #manageMenuModal .modal-dialog {
            max-width: 1200px;
        }

        #addDishModal .modal-dialog {
            max-width: 900px;
        }

        .measurement-unit-item {
            transition: all 0.3s ease;
        }

        .measurement-unit-item:hover {
            border-color: #dc3545 !important;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.15) !important;
        }

        /* Animaci√≥n para nuevas unidades */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .measurement-unit-item {
            animation: slideIn 0.3s ease-out;
        }

        /* Estilo para inputs con focus */
        .form-control:focus {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        /* Badge de precio mejorado */
        .badge-price {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            font-size: 1rem;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        /* Estilos para bot√≥n toggle con transici√≥n suave tipo switch */
        .btn-toggle {
            min-width: 48px !important;
            width: 48px;
            height: 31px;
            padding: 0 !important;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-toggle i {
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-toggle.btn-success {
            background: linear-gradient(135deg, #198754 0%, #157347 100%);
        }

        .btn-toggle.btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5c636a 100%);
        }

        /* Animaci√≥n al cambiar estado */
        @keyframes toggleSwitch {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        .btn-toggle.switching i {
            animation: toggleSwitch 0.5s ease-in-out;
        }

        /* Animaciones para toast notifications */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Estilos para campos bloqueados - Roles del sistema */
        input[disabled], textarea[disabled], select[disabled] {
            cursor: not-allowed !important;
            background-color: #e9ecef !important;
            opacity: 0.7;
        }

        .form-check-input[disabled] {
            cursor: not-allowed !important;
            opacity: 0.5;
        }

        .form-check-input[disabled] ~ label {
            cursor: not-allowed !important;
            opacity: 0.6;
        }

        /* Badge de rol protegido */
        #editRolSystemBadge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Sticky header para tablas */
        .sticky-top {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #f8f9fa !important;
        }

        /* Estilos mejorados para tarjetas de estad√≠sticas */
        .card.h-100 {
            cursor: pointer;
        }

        .card.h-100:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15) !important;
        }

        /* Modo oscuro para tarjetas de estad√≠sticas */
        [data-theme="dark"] .card.h-100 {
            background: var(--bg-secondary) !important;
        }

        [data-theme="dark"] .card.h-100 .card-body {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%) !important;
        }

        [data-theme="dark"] .card.h-100:nth-child(2) .card-body {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.9) 0%, rgba(32, 201, 151, 0.9) 100%) !important;
        }

        [data-theme="dark"] .card.h-100:nth-child(3) .card-body {
            background: linear-gradient(135deg, rgba(198, 40, 40, 0.9) 0%, rgba(245, 166, 35, 0.9) 100%) !important;
        }

        [data-theme="dark"] .card.h-100:nth-child(4) .card-body {
            background: linear-gradient(135deg, rgba(13, 202, 240, 0.9) 0%, rgba(13, 110, 253, 0.9) 100%) !important;
        }

        [data-theme="dark"] .card.h-100:hover {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4) !important;
        }

        /* Animaci√≥n para iconos en hover */
        .card.h-100:hover .rounded-circle {
            animation: pulse 0.6s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
    </style>
    <script>
    // Funcion GLOBAL para cambiar secciones - DEFINIDA ANTES DE CARGAR EL BODY
    function showSection(sectionName) {
        console.log('>>> Cambiando a seccion:', sectionName);
        
        // Ocultar todas las secciones
        var sections = document.querySelectorAll('.menu-section');
        sections.forEach(function(section) {
            section.classList.remove('active');
        });
        
        // Mostrar la secci√≥n seleccionada
        var targetSection = document.getElementById(sectionName + '-content');
        if (targetSection) {
            targetSection.classList.add('active');
            console.log('Secci√≥n mostrada:', sectionName + '-content');
        } else {
            console.error('No se encontr√≥ la secci√≥n:', sectionName + '-content');
        }
        
        // Actualizar links activos en el sidebar
        var links = document.querySelectorAll('.sidebar .nav-link');
        links.forEach(function(link) {
            link.classList.remove('active');
            if (link.getAttribute('data-section') === sectionName) {
                link.classList.add('active');
            }
        });
    }
    </script>
</head>
<body>

<!-- Barra de Navegaci√≥n -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/" th:href="@{/}">FoodIx Admin</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="menuNav">
            <ul class="navbar-nav ms-auto">
                <!-- Bot√≥n de Tema Claro/Oscuro -->
                <li class="nav-item d-flex align-items-center">
                    <button class="theme-toggle" type="button" aria-label="Cambiar tema">
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                    </button>
                </li>
                <li class="nav-item">
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-shield"></i> <span>Administrador</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <button type="button" class="dropdown-item" onclick="cerrarSesion()" style="border: none; background: none; cursor: pointer; width: 100%; text-align: left;">
                                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                                </button>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Mensajes Flash como Modales -->
<!-- <div th:replace="fragments/flash-messages :: flashMessages"></div> -->

<!-- Contenido Principal -->
<main class="container-fluid" style="padding-top: 90px;">

    <div class="row">
        <!-- Sidebar de navegaci√≥n -->
        <div class="col-md-3 col-lg-2 sidebar">
            <div class="sidebar-content">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-shield fa-3x"></i>
                    </div>
                    <h5>Administrador</h5>
                </div>

                <ul class="nav nav-pills flex-column">
                    <!-- Gestion de Clientes - Solo si tiene permiso 'clientes' -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('usuarios')" data-section="usuarios">
                            <i class="fas fa-users"></i> Clientes
                        </a>
                    </li>
                    
                    <!-- Restaurantes - Solo si tiene permiso 'restaurantes' -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('restaurantes')" data-section="restaurantes">
                            <i class="fas fa-store"></i> Restaurantes
                        </a>
                    </li>
                    
                    <!-- Repartidores - Solo si tiene permiso 'delivery' -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('delivery')" data-section="delivery">
                            <i class="fas fa-motorcycle"></i> Repartidores
                        </a>
                    </li>
                    
                    <!-- Reportes - Visible para todos (o agregar permiso espec√≠fico) -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('reportes')" data-section="reportes">
                            <i class="fas fa-chart-bar"></i> Reportes
                        </a>
                    </li>
                    
                    <!-- Ganancias de la Plataforma -->
                    <li class="nav-item">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('ganancias')" data-section="ganancias">
                            <i class="fas fa-hand-holding-usd"></i> Ganancias FooDIx
                        </a>
                    </li>
                    
                    <!-- Configuraci√≥n - Solo si tiene permiso 'configuracion' -->
                    <li class="nav-item" th:if="${permisosUsuario.contains('configuracion')}">
                        <a class="nav-link" href="javascript:void(0)" onclick="showSection('configuracion')" data-section="configuracion">
                            <i class="fas fa-cog"></i> Configuraci√≥n
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="col-md-9 col-lg-10 main-content">
            <!-- =====================================================
                 üí∞ SECCI√ìN GANANCIAS DE LA PLATAFORMA
                 ===================================================== -->
            <section id="ganancias-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-hand-holding-usd"></i> Ganancias de FooDIx</h2>
                    <p class="text-muted">Sistema de comisiones y ganancias de la plataforma</p>
                </div>

                <!-- Tarjetas de resumen -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-3" style="width: 70px; height: 70px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-dollar-sign fa-2x text-white"></i>
                                </div>
                                <h6 class="text-muted mb-2">Ganancias Totales</h6>
                                <h3 class="mb-0 text-success" id="gananciasTotales">S/ 0.00</h3>
                                <small class="text-muted">Acumulado hist√≥rico</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-3" style="width: 70px; height: 70px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-calendar-alt fa-2x text-white"></i>
                                </div>
                                <h6 class="text-muted mb-2">Ganancias del Mes</h6>
                                <h3 class="mb-0 text-primary" id="gananciasMes">S/ 0.00</h3>
                                <small class="text-muted" id="mesActual">Mes actual</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-3" style="width: 70px; height: 70px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-calendar-day fa-2x text-white"></i>
                                </div>
                                <h6 class="text-muted mb-2">Ganancias de Hoy</h6>
                                <h3 class="mb-0 text-danger" id="gananciasHoy">S/ 0.00</h3>
                                <small class="text-muted">Ganancias diarias</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-3" style="width: 70px; height: 70px; background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-percentage fa-2x text-white"></i>
                                </div>
                                <h6 class="text-muted mb-2">Comisi√≥n Actual</h6>
                                <h3 class="mb-0 text-warning" id="porcentajeComision">5.00%</h3>
                                <button class="btn btn-sm btn-outline-warning mt-2" data-bs-toggle="modal" data-bs-target="#configComisionModal">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n adicional -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-info-circle text-info"></i> Informaci√≥n del Sistema de Comisiones
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="list-unstyled">
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> Las comisiones se calculan sobre el subtotal (sin delivery)</li>
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> Se registran autom√°ticamente en cada pedido</li>
                                            <li class="mb-2"><i class="fas fa-check text-success"></i> El porcentaje es configurable desde el panel</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="alert alert-light border-start border-primary border-4 mb-0">
                                            <h6 class="alert-heading"><i class="fas fa-calculator"></i> Ejemplo de C√°lculo:</h6>
                                            <p class="mb-1">‚Ä¢ Subtotal pedido: <strong>S/ 100.00</strong></p>
                                            <p class="mb-1">‚Ä¢ Comisi√≥n (5%): <strong class="text-success">S/ 5.00</strong> (FooDIx)</p>
                                            <p class="mb-0">‚Ä¢ Monto restaurante: <strong>S/ 95.00</strong></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de historial -->
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="fas fa-history"></i> Historial de Ganancias</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="tablaGanancias">
                                <thead>
                                    <tr>
                                        <th>Pedido #</th>
                                        <th>Fecha</th>
                                        <th>Subtotal</th>
                                        <th>Comisi√≥n (%)</th>
                                        <th>Ganancia FooDIx</th>
                                        <th>Monto Restaurante</th>
                                    </tr>
                                </thead>
                                <tbody id="historialGanancias">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            <i class="fas fa-spinner fa-spin"></i> Cargando datos...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Usuarios/Clientes - Solo si tiene permiso -->
            <section id="usuarios-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Gesti√≥n de Clientes</h2>
                    <p class="text-muted">Administra los clientes de la plataforma</p>
                </div>

                <!-- Filtros de b√∫squeda en tiempo real -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filtros</h5>
                        <form onsubmit="return false" class="row g-3">
                            <div class="col-md-4">
                                <label for="filterClienteName" class="form-label"><i class="fas fa-search"></i> Buscar por Nombre</label>
                                <input type="text" class="form-control" id="filterClienteName" name="clienteName" 
                                       placeholder="Ingrese nombre o apellido...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterClienteDni" class="form-label"><i class="fas fa-id-card"></i> DNI</label>
                                <input type="text" class="form-control" id="filterClienteDni" name="clienteDni" 
                                       placeholder="N√∫mero de documento...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterClienteEstado" class="form-label"><i class="fas fa-toggle-on"></i> Estado</label>
                                <select class="form-select" id="filterClienteEstado" name="clienteEstado">
                                    <option value="">Todos</option>
                                    <option value="true">Activos</option>
                                    <option value="false">Inactivos</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Tabla de clientes -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>DNI</th>
                                        <th>Tel√©fono</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="user : ${clientes}">
                                        <td th:text="${user.codigo}">1</td>
                                        <td th:text="${user.nombreCompleto}">John Doe</td>
                                        <td th:text="${user.numeroDocumento != null ? user.numeroDocumento : 'N/A'}">12345678</td>
                                        <td th:text="${user.telefono != null ? user.telefono : 'N/A'}">999999999</td>
                                        <td>
                                            <span th:class="${user.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${user.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group" aria-label="Acciones de usuario">
                                                <!-- Bot√≥n Ver Detalles -->
                                                <button type="button" class="btn btn-sm btn-primary btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#viewClientModal"
                                                        th:data-id="${user.codigo}"
                                                        th:data-name="${user.nombreCompleto}"
                                                        th:data-email="${user.correoElectronico}"
                                                        th:data-dni="${user.numeroDocumento}"
                                                        th:data-phone="${user.telefono}"
                                                        th:data-address="${user.direccion}"
                                                        title="Ver detalles completos">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Modificar -->
                                                <button type="button" class="btn btn-sm btn-info btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#editUserModal"
                                                        th:data-id="${user.codigo}"
                                                        th:data-name="${user.nombre}"
                                                        th:data-lastname="${user.apellidoPaterno + ' ' + user.apellidoMaterno}"
                                                        th:data-email="${user.correoElectronico}"
                                                        th:data-phone="${user.telefono}"
                                                        th:data-address="${user.direccion}"
                                                        title="Editar informaci√≥n">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Cambiar Estado -->
                                                <button type="button" 
                                                        class="btn btn-toggle"
                                                        th:classappend="${user.estado ? 'btn-success' : 'btn-secondary'}"
                                                        th:onclick="'toggleUserStatus(' + ${user.codigo} + ', ' + ${user.estado} + ', this)'"
                                                        th:title="${user.estado ? 'Desactivar usuario' : 'Activar usuario'}">
                                                    <i th:class="${user.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <a href="/api/export/usuarios" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> Exportar a Excel
                        </a>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Restaurantes - Solo si tiene permiso -->
            <section id="restaurantes-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-store"></i> Gesti√≥n de Restaurantes</h2>
                    <p class="text-muted">Administra los restaurantes asociados</p>
                </div>

                <!-- Filtros de b√∫squeda en tiempo real -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filtros</h5>
                        <form onsubmit="return false" class="row g-3">
                            <div class="col-md-4">
                                <label for="filterRestaurantName" class="form-label"><i class="fas fa-search"></i> Buscar por Nombre</label>
                                <input type="text" class="form-control" id="filterRestaurantName" name="restaurantName" 
                                       placeholder="Nombre comercial o raz√≥n social...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterRestaurantRuc" class="form-label"><i class="fas fa-id-card"></i> RUC</label>
                                <input type="text" class="form-control" id="filterRestaurantRuc" name="restaurantRuc" 
                                       placeholder="N√∫mero de RUC...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterRestaurantEstado" class="form-label"><i class="fas fa-check-circle"></i> Estado</label>
                                <select class="form-select" id="filterRestaurantEstado" name="restaurantEstado">
                                    <option value="">Todos</option>
                                    <option value="PENDING">Pendientes</option>
                                    <option value="APPROVED">Aprobados</option>
                                    <option value="REJECTED">Rechazados</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Lista de restaurantes-->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 5%;">ID</th>
                                        <th style="width: 20%;">Nombre Comercial</th>
                                        <th style="width: 12%;">RUC</th>
                                        <th style="width: 18%;">Email</th>
                                        <th style="width: 10%;" class="text-center">Estado Aprobaci√≥n</th>
                                        <th style="width: 10%;" class="text-center">Estado</th>
                                        <th style="width: 25%;" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Restaurantes Pendientes -->
                                    <tr th:if="${pendingRestaurants != null and !pendingRestaurants.isEmpty()}" 
                                        class="table-warning">
                                        <td colspan="7" class="text-center fw-bold py-3">
                                            <i class="fas fa-clock fa-lg"></i> RESTAURANTES PENDIENTES DE APROBACI√É‚ÄúN
                                        </td>
                                    </tr>
                                    <tr th:each="restaurant : ${pendingRestaurants}">
                                        <td class="fw-bold" th:text="${restaurant.codigo}">1</td>
                                        <td>
                                            <div class="fw-bold" th:text="${restaurant.nombre}">Restaurante A</div>
                                            <small class="text-muted" th:text="${restaurant.razonSocial}">Razon Social</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${restaurant.ruc}">20131312955</span>
                                        </td>
                                        <td>
                                            <small th:text="${restaurant.correoElectronico}">restaurante@example.com</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-warning text-dark px-3 py-2">
                                                <i class="fas fa-clock"></i> Pendiente
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <span th:class="${restaurant.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${restaurant.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group" aria-label="Acciones de restaurante">
                                                <!-- Bot√≥n Ver Detalles -->
                                                <button type="button" class="btn btn-sm btn-info btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#viewRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        th:data-razon="${restaurant.razonSocial}"
                                                        th:data-ruc="${restaurant.ruc}"
                                                        th:data-email="${restaurant.correoElectronico}"
                                                        th:data-telefono="${restaurant.telefono}"
                                                        th:data-direccion="${restaurant.direccion}"
                                                        title="Ver detalles y documentos">
                                                    <i class="fas fa-eye"></i>
                                                </button>

                                                <!-- Bot√≥n Aprobar -->
                                                <button type="button" class="btn btn-sm btn-success btn-toggle" 
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#approveRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        title="Aprobar restaurante">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Rechazar -->
                                                <button type="button" class="btn btn-sm btn-danger btn-toggle" 
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#rejectRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        title="Rechazar restaurante">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- Restaurantes Aprobados -->
                                    <tr th:if="${approvedRestaurants != null and !approvedRestaurants.isEmpty()}" 
                                        class="table-success">
                                        <td colspan="7" class="text-center fw-bold py-3">
                                            <i class="fas fa-check-circle fa-lg"></i> RESTAURANTES APROBADOS
                                        </td>
                                    </tr>
                                    <tr th:each="restaurant : ${approvedRestaurants}">
                                        <td class="fw-bold" th:text="${restaurant.codigo}">1</td>
                                        <td>
                                            <div class="fw-bold" th:text="${restaurant.nombre}">Restaurante B</div>
                                            <small class="text-muted" th:text="${restaurant.razonSocial}">Razon Social</small>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary" th:text="${restaurant.ruc}">20131312955</span>
                                        </td>
                                        <td>
                                            <small th:text="${restaurant.correoElectronico}">restaurante@example.com</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-success px-3 py-2">
                                                <i class="fas fa-check-circle"></i> Aprobado
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <span th:class="${restaurant.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${restaurant.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group" aria-label="Acciones de restaurante">
                                                <!-- Bot√≥n Ver Detalles -->
                                                <button type="button" class="btn btn-sm btn-primary btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#viewRestaurantModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        th:data-razon="${restaurant.razonSocial}"
                                                        th:data-ruc="${restaurant.ruc}"
                                                        th:data-email="${restaurant.correoElectronico}"
                                                        th:data-telefono="${restaurant.telefono}"
                                                        th:data-direccion="${restaurant.direccion}"
                                                        title="Ver detalles completos">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Gestionar Men√∫ -->
                                                <button type="button" class="btn btn-sm btn-info btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#manageMenuModal"
                                                        th:data-id="${restaurant.codigo}"
                                                        th:data-nombre="${restaurant.nombre}"
                                                        title="Gestionar men√∫ del restaurante">
                                                    <i class="fas fa-utensils"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Cambiar Estado -->
                                                <button type="button" 
                                                        class="btn btn-toggle"
                                                        th:classappend="${restaurant.estado ? 'btn-success' : 'btn-secondary'}"
                                                        th:onclick="'toggleRestaurantStatus(' + ${restaurant.codigo} + ', ' + ${restaurant.estado} + ', this)'"
                                                        th:title="${restaurant.estado ? 'Desactivar restaurante' : 'Activar restaurante'}">
                                                    <i th:class="${restaurant.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- Mensaje si no hay restaurantes -->
                                    <tr th:if="${(pendingRestaurants == null or pendingRestaurants.isEmpty()) and (approvedRestaurants == null or approvedRestaurants.isEmpty())}">
                                        <td colspan="7" class="text-center text-muted">
                                            <i class="fas fa-info-circle"></i> No hay restaurantes registrados
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <a href="/api/export/restaurantes" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> Exportar a Excel
                        </a>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Delivery - Solo si tiene permiso -->
            <section id="delivery-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-motorcycle"></i> Gesti√≥n de Repartidores</h2>
                    <p class="text-muted">Administra los repartidores de la plataforma</p>
                </div>

                <!-- Filtros de b√∫squeda en tiempo real -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filtros</h5>
                        <form onsubmit="return false" class="row g-3">
                            <div class="col-md-4">
                                <label for="filterDeliveryName" class="form-label"><i class="fas fa-search"></i> Buscar por Nombre</label>
                                <input type="text" class="form-control" id="filterDeliveryName" name="deliveryName" 
                                       placeholder="Ingrese nombre o apellido...">
                            </div>
                            <div class="col-md-3">
                                <label for="filterDeliveryEmail" class="form-label"><i class="fas fa-envelope"></i> Email</label>
                                <input type="email" class="form-control" id="filterDeliveryEmail" name="deliveryEmail" 
                                       placeholder="email@ejemplo.com">
                            </div>
                            <div class="col-md-3">
                                <label for="filterDeliveryEstado" class="form-label"><i class="fas fa-check-circle"></i> Estado Aprobacion</label>
                                <select class="form-select" id="filterDeliveryEstado" name="deliveryEstado">
                                    <option value="">Todos</option>
                                    <option value="PENDING">Pendientes</option>
                                    <option value="APPROVED">Aprobados</option>
                                    <option value="REJECTED">Rechazados</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Repartidores Pendientes de Aprobaci√≥n -->
                <div class="card mb-3" th:if="${pendingRepartidores != null and #lists.size(pendingRepartidores) > 0}">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-clock"></i> Repartidores Pendientes de Aprobaci√≥n</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Tel√©fono</th>
                                        <th>Licencia</th>
                                        <th>Veh√≠culo</th>
                                        <th>Fecha Registro</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="delivery : ${pendingRepartidores}">
                                        <td th:text="${delivery.codigo}">1</td>
                                        <td th:text="${delivery.usuario != null ? (delivery.usuario.nombre + ' ' + delivery.usuario.apellidoPaterno) : 'N/A'}">Juan P√©rez</td>
                                        <td th:text="${delivery.usuario != null ? delivery.usuario.correoElectronico : 'N/A'}">delivery@example.com</td>
                                        <td th:text="${delivery.usuario != null and delivery.usuario.telefono != null ? delivery.usuario.telefono : 'N/A'}">999999999</td>
                                        <td th:text="${delivery.numeroLicencia}">ABC123456</td>
                                        <td th:text="${delivery.tipoVehiculo != null ? delivery.tipoVehiculo.nombre : 'N/A'}">Motocicleta</td>
                                        <td th:text="${#temporals.format(delivery.fechaCreacion, 'dd/MM/yyyy HH:mm')}">01/01/2025 10:00</td>
                                        <td>
                                            <div class="btn-group" role="group" aria-label="Acciones de repartidor pendiente">
                                                <!-- Bot√≥n Aprobar -->
                                                <button type="button" class="btn btn-sm btn-success btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#approveDeliveryModal"
                                                        th:data-id="${delivery.codigo}"
                                                        th:data-name="${delivery.usuario != null ? (delivery.usuario.nombre + ' ' + delivery.usuario.apellidoPaterno) : 'Repartidor'}"
                                                        title="Aprobar repartidor"
                                                        aria-label="Aprobar">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Rechazar -->
                                                <button type="button" class="btn btn-sm btn-danger btn-toggle" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#rejectDeliveryModal"
                                                        th:data-id="${delivery.codigo}"
                                                        th:data-name="${delivery.usuario != null ? (delivery.usuario.nombre + ' ' + delivery.usuario.apellidoPaterno) : 'Repartidor'}"
                                                        title="Rechazar repartidor"
                                                        aria-label="Rechazar">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Mensaje si no hay pendientes -->
                <div class="alert alert-info" th:if="${pendingRepartidores == null or #lists.isEmpty(pendingRepartidores)}">
                    <i class="fas fa-info-circle"></i> No hay repartidores pendientes de aprobaci√≥n
                </div>

                <!-- Repartidores Aprobados -->
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-check-circle"></i> Repartidores Aprobados</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Tel√©fono</th>
                                        <th>Licencia</th>
                                        <th>Veh√≠culo</th>
                                        <th>Disponible</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="delivery : ${approvedRepartidores}">
                                        <td th:text="${delivery.codigo}">1</td>
                                        <td th:text="${delivery.usuario != null ? (delivery.usuario.nombre + ' ' + delivery.usuario.apellidoPaterno) : 'N/A'}">Juan P√©rez</td>
                                        <td th:text="${delivery.usuario != null ? delivery.usuario.correoElectronico : 'N/A'}">delivery@example.com</td>
                                        <td th:text="${delivery.usuario != null and delivery.usuario.telefono != null ? delivery.usuario.telefono : 'N/A'}">999999999</td>
                                        <td th:text="${delivery.numeroLicencia}">ABC123456</td>
                                        <td th:text="${delivery.tipoVehiculo != null ? delivery.tipoVehiculo.nombre : 'N/A'}">Motocicleta</td>
                                        <td>
                                            <span th:class="${delivery.disponible ? 'badge bg-success' : 'badge bg-secondary'}"
                                                  th:text="${delivery.disponible ? 'Disponible' : 'No disponible'}">
                                                Disponible
                                            </span>
                                        </td>
                                        <td>
                                            <span th:class="${delivery.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${delivery.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group" aria-label="Acciones de repartidor">
                                                <!-- Bot√≥n Cambiar Disponibilidad -->
                                                <button type="button" 
                                                        class="btn btn-toggle"
                                                        th:classappend="${delivery.disponible ? 'btn-info' : 'btn-secondary'}"
                                                        th:onclick="'toggleDeliveryAvailability(' + ${delivery.codigo} + ', ' + ${delivery.disponible} + ', this)'"
                                                        th:title="${delivery.disponible ? 'Marcar no disponible' : 'Marcar disponible'}">
                                                    <i th:class="${delivery.disponible ? 'fas fa-user-check' : 'fas fa-user-times'}"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Cambiar Estado -->
                                                <button type="button" 
                                                        class="btn btn-toggle"
                                                        th:classappend="${delivery.estado ? 'btn-success' : 'btn-secondary'}"
                                                        th:onclick="'toggleDeliveryStatus(' + ${delivery.codigo} + ', ' + ${delivery.estado} + ', this)'"
                                                        th:title="${delivery.estado ? 'Desactivar' : 'Activar'}">
                                                    <i th:class="${delivery.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <p class="text-muted mb-0">
                            Total: <strong th:text="${approvedRepartidores != null ? #lists.size(approvedRepartidores) : 0}">0</strong> repartidores aprobados
                        </p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Reportes -->
            <section id="reportes-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Reportes y Estad√≠sticas</h2>
                    <p class="text-muted">Visualiza las estad√≠sticas de la plataforma</p>
                </div>

                <!-- Tarjetas de resumen -->
                <div class="row mb-4 g-4">
                    <div class="col-md-3">
                        <div class="card h-100 shadow-sm" style="border: none; border-radius: 16px; overflow: hidden; transition: all 0.3s ease;">
                            <div class="card-body" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem;">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <h6 class="text-white-50 text-uppercase mb-2" style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;">Usuarios Totales</h6>
                                        <h2 class="mb-0 fw-bold" th:text="${stats != null and stats.totalUsers != null ? stats.totalUsers : 0}">0</h2>
                                    </div>
                                    <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                        <i class="fas fa-users fa-2x"></i>
                                    </div>
                                </div>
                                <div class="progress" style="height: 4px; background-color: rgba(255,255,255,0.3);">
                                    <div class="progress-bar bg-white" role="progressbar" style="width: 75%;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card h-100 shadow-sm" style="border: none; border-radius: 16px; overflow: hidden; transition: all 0.3s ease;">
                            <div class="card-body" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 1.5rem;">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <h6 class="text-white-50 text-uppercase mb-2" style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;">Ventas del Mes</h6>
                                        <h2 class="mb-0 fw-bold" th:text="${stats != null and stats.monthSales != null ? stats.monthSales : 0}">0</h2>
                                    </div>
                                    <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                        <i class="fas fa-chart-line fa-2x"></i>
                                    </div>
                                </div>
                                <div class="progress" style="height: 4px; background-color: rgba(255,255,255,0.3);">
                                    <div class="progress-bar bg-white" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card h-100 shadow-sm" style="border: none; border-radius: 16px; overflow: hidden; transition: all 0.3s ease;">
                            <div class="card-body" style="background: linear-gradient(135deg, #C62828 0%, #F5A623 100%); color: white; padding: 1.5rem;">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <h6 class="text-white-50 text-uppercase mb-2" style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;">Pedidos Activos</h6>
                                        <h2 class="mb-0 fw-bold" th:text="${stats != null and stats.activeOrders != null ? stats.activeOrders : 0}">0</h2>
                                    </div>
                                    <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                        <i class="fas fa-shopping-bag fa-2x"></i>
                                    </div>
                                </div>
                                <div class="progress" style="height: 4px; background-color: rgba(255,255,255,0.3);">
                                    <div class="progress-bar bg-white" role="progressbar" style="width: 85%;" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card h-100 shadow-sm" style="border: none; border-radius: 16px; overflow: hidden; transition: all 0.3s ease;">
                            <div class="card-body" style="background: linear-gradient(135deg, #0dcaf0 0%, #0d6efd 100%); color: white; padding: 1.5rem;">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <h6 class="text-white-50 text-uppercase mb-2" style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;">Restaurantes</h6>
                                        <h2 class="mb-0 fw-bold" th:text="${stats != null and stats.totalRestaurants != null ? stats.totalRestaurants : 0}">0</h2>
                                    </div>
                                    <div class="bg-white bg-opacity-25 rounded-circle p-3">
                                        <i class="fas fa-store fa-2x"></i>
                                    </div>
                                </div>
                                <div class="progress" style="height: 4px; background-color: rgba(255,255,255,0.3);">
                                    <div class="progress-bar bg-white" role="progressbar" style="width: 70%;" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Configuraci√≥n - Solo si tiene permiso -->
            <section id="configuracion-content" class="menu-section">
                <div class="section-header">
                    <h2><i class="fas fa-cog"></i> Configuraci√≥n del Sistema</h2>
                    <p class="text-muted">Administra la configuraci√≥n general de la plataforma</p>
                </div>

                <div class="row g-4">
                    <!-- Tarjeta Categor√≠as -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-tags fa-4x text-primary"></i>
                                </div>
                                <h5 class="card-title">Categor√≠as</h5>
                                <p class="card-text text-muted">Gestiona las categor√≠as de restaurantes y productos</p>
                                <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#manageCategoriesModal">
                                    <i class="fas fa-cog"></i> Gestionar Categor√≠as
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tarjeta Administradores -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-users-cog fa-4x text-success"></i>
                                </div>
                                <h5 class="card-title">Administradores</h5>
                                <p class="card-text text-muted">Administra los usuarios con rol de administrador</p>
                                <button type="button" class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#manageAdminsModal">
                                    <i class="fas fa-cog"></i> Gestionar Usuarios del Sistema
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tarjeta Roles -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-user-tag fa-4x text-warning"></i>
                                </div>
                                <h5 class="card-title">Roles</h5>
                                <p class="card-text text-muted">Visualiza y gestiona los roles del sistema</p>
                                <button type="button" class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#manageRolesModal">
                                    <i class="fas fa-cog"></i> Ver Roles
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- Modal para editar usuario -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel"><i class="fas fa-user-edit"></i> Modificar Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editUserForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editUserName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editUserName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editUserLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editUserEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserPhone" class="form-label">Tel√©fono</label>
                        <input type="text" class="form-control" id="editUserPhone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label for="editUserAddress" class="form-label">Direcci√≥n</label>
                        <input type="text" class="form-control" id="editUserAddress" name="address">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para ver detalles del cliente -->
<div class="modal fade" id="viewClientModal" tabindex="-1" aria-labelledby="viewClientModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="viewClientModalLabel">
                    <i class="fas fa-user"></i> Detalles del Cliente
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Informaci√≥n del Cliente -->
                <div class="row mb-3">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-info-circle text-primary"></i> Informaci√≥n Personal
                        </h5>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Nombre Completo:</dt>
                            <dd class="col-sm-7 fw-bold" id="viewClientName">-</dd>
                            
                            <dt class="col-sm-5">DNI:</dt>
                            <dd class="col-sm-7">
                                <span class="badge bg-secondary" id="viewClientDni">-</span>
                            </dd>
                            
                            <dt class="col-sm-5">Email:</dt>
                            <dd class="col-sm-7" id="viewClientEmail">-</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Tel√©fono:</dt>
                            <dd class="col-sm-7" id="viewClientPhone">-</dd>
                            
                            <dt class="col-sm-5">Direcci√≥n:</dt>
                            <dd class="col-sm-7" id="viewClientAddress">-</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para editar repartidor -->
<div class="modal fade" id="editDeliveryModal" tabindex="-1" aria-labelledby="editDeliveryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDeliveryModalLabel"><i class="fas fa-motorcycle"></i> Modificar Repartidor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editDeliveryForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editDeliveryName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editDeliveryName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editDeliveryLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editDeliveryEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryPhone" class="form-label">Tel√©fono</label>
                        <input type="text" class="form-control" id="editDeliveryPhone" name="phone">
                    </div>
                    <div class="mb-3">
                        <label for="editDeliveryAddress" class="form-label">Direcci√≥n</label>
                        <input type="text" class="form-control" id="editDeliveryAddress" name="address">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para ver detalles del restaurante -->
<div class="modal fade" id="viewRestaurantModal" tabindex="-1" aria-labelledby="viewRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="viewRestaurantModalLabel">
                    <i class="fas fa-store"></i> Detalles del Restaurante
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Informaci√≥n General -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-info-circle text-primary"></i> Informaci√≥n General
                        </h5>   
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Nombre Comercial:</dt>
                            <dd class="col-sm-7 fw-bold" id="viewRestaurantNombre">-</dd>
                            
                            <dt class="col-sm-5">Raz√≥n Social:</dt>
                            <dd class="col-sm-7" id="viewRestaurantRazon">-</dd>
                            
                            <dt class="col-sm-5">RUC:</dt>
                            <dd class="col-sm-7">
                                <span class="badge bg-secondary" id="viewRestaurantRuc">-</span>
                            </dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Email:</dt>
                            <dd class="col-sm-7" id="viewRestaurantEmail">-</dd>
                            
                            <dt class="col-sm-5">Tel√©fono:</dt>
                            <dd class="col-sm-7" id="viewRestaurantTelefono">-</dd>
                            
                            <dt class="col-sm-5">Direcci√≥n:</dt>
                            <dd class="col-sm-7" id="viewRestaurantDireccion">-</dd>
                        </dl>
                    </div>
                </div>
                
                <!-- Documentos -->
                <div class="row">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-file-alt text-success"></i> Documentos de Verificaci√≥n
                        </h5>
                    </div>
                </div>
                
                <div class="row g-3">
                    <!-- Carta del Restaurante -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-utensils fa-3x text-warning mb-3"></i>
                                <h6 class="card-title">Carta del Restaurante</h6>
                                <p class="card-text text-muted small">Men√∫ y oferta gastron√≥mica</p>
                                <button type="button" class="btn btn-sm btn-outline-primary w-100" id="btnVerCarta"
                                        onclick="if(this.dataset.ruta) window.open('/files/view/' + this.dataset.ruta, '_blank'); else alert('Documento no disponible');">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carnet de Sanidad -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-notes-medical fa-3x text-success mb-3"></i>
                                <h6 class="card-title">Carnet de Sanidad</h6>
                                <p class="card-text text-muted small">Certificado sanitario vigente</p>
                                <button type="button" class="btn btn-sm btn-outline-primary w-100" id="btnVerSanidad"
                                        onclick="if(this.dataset.ruta) window.open('/files/view/' + this.dataset.ruta, '_blank'); else alert('Documento no disponible');">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Licencia de Funcionamiento -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <i class="fas fa-certificate fa-3x text-info mb-3"></i>
                                <h6 class="card-title">Licencia de Funcionamiento</h6>
                                <p class="card-text text-muted small">Autorizaci√≥n municipal</p>
                                <button type="button" class="btn btn-sm btn-outline-primary w-100" id="btnVerLicencia"
                                        onclick="if(this.dataset.ruta) window.open('/files/view/' + this.dataset.ruta, '_blank'); else alert('Documento no disponible');">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Nota:</strong> Todos los documentos son obligatorios para la aprobaci√≥n del restaurante. 
                    Verifica que est√©n completos y actualizados antes de aprobar.
                </div>
                
                <!-- Secci√≥n para subir/actualizar documentos -->
                <div class="row mt-4">
                    <div class="col-12">
                        <h5 class="border-bottom pb-2 mb-3">
                            <i class="fas fa-upload text-primary"></i> Subir/Actualizar Documentos
                        </h5>
                    </div>
                </div>
                
                <form id="uploadDocumentsForm" enctype="multipart/form-data">
                    <input type="hidden" id="uploadRestaurantId" name="restaurantId">
                    
                    <div class="row g-3">
                        <!-- Upload Carta -->
                        <div class="col-md-4">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-utensils text-warning"></i> Carta del Restaurante
                                    </label>
                                    <input type="file" class="form-control form-control-sm" 
                                           name="cartaRestaurante" 
                                           accept=".pdf,.jpg,.jpeg,.png"
                                           onchange="previewFileName(this)">
                                    <small class="text-muted d-block mt-1">PDF o Imagen (Max 5MB)</small>
                                    <small class="text-success d-none upload-status-carta">
                                        <i class="fas fa-check-circle"></i> Listo para subir
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upload Carnet Sanidad -->
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-notes-medical text-success"></i> Carnet de Sanidad
                                    </label>
                                    <input type="file" class="form-control form-control-sm" 
                                           name="carnetSanidad" 
                                           accept=".pdf,.jpg,.jpeg,.png"
                                           onchange="previewFileName(this)">
                                    <small class="text-muted d-block mt-1">PDF o Imagen (Max 5MB)</small>
                                    <small class="text-success d-none upload-status-sanidad">
                                        <i class="fas fa-check-circle"></i> Listo para subir
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upload Licencia -->
                        <div class="col-md-4">
                            <div class="card border-info">
                                <div class="card-body">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-certificate text-info"></i> Licencia de Funcionamiento
                                    </label>
                                    <input type="file" class="form-control form-control-sm" 
                                           name="licenciaFuncionamiento" 
                                           accept=".pdf,.jpg,.jpeg,.png"
                                           onchange="previewFileName(this)">
                                    <small class="text-muted d-block mt-1">PDF o Imagen (Max 5MB)</small>
                                    <small class="text-success d-none upload-status-licencia">
                                        <i class="fas fa-check-circle"></i> Listo para subir
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning mt-3 mb-0">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>Importante:</strong> Solo sube los documentos que quieras actualizar. Los campos vac√≠os no se modificar√°n.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
                <button type="button" class="btn btn-primary" onclick="uploadDocuments()">
                    <i class="fas fa-upload"></i> Subir Documentos
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para aprobar restaurante -->
<div class="modal fade" id="approveRestaurantModal" tabindex="-1" aria-labelledby="approveRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="approveRestaurantModalLabel"><i class="fas fa-check-circle"></i> Aprobar Restaurante</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="approveRestaurantForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="hidden" name="section" value="restaurantes">
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-store-alt fa-4x text-success"></i>
                    </div>
                    <p class="text-center fs-5">¬øEst√° seguro de aprobar el restaurante <strong id="approveRestaurantNombre"></strong>?</p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Esto permitir√° que puedan acceder al sistema y comenzar a publicar su men√∫.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times"></i> Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> S√≠, Aprobar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para rechazar restaurante -->
<div class="modal fade" id="rejectRestaurantModal" tabindex="-1" aria-labelledby="rejectRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="rejectRestaurantModalLabel"><i class="fas fa-times-circle"></i> Rechazar Restaurante</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="rejectRestaurantForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body">
                    <input type="hidden" name="section" value="restaurantes">
                    <p>¬øEst√° seguro de rechazar el restaurante <strong id="rejectRestaurantNombre"></strong>?</p>
                    <div class="mb-3">
                        <label for="motivoRechazo" class="form-label">Motivo del Rechazo <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="motivoRechazo" name="motivo" rows="4" 
                                  placeholder="Explique el motivo del rechazo (m√≠nimo 10 caracteres)" 
                                  required minlength="10"></textarea>
                        <div class="form-text">Este motivo ser√° visible para el restaurante.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger"><i class="fas fa-times"></i> Rechazar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para aprobar repartidor -->
<div class="modal fade" id="approveDeliveryModal" tabindex="-1" aria-labelledby="approveDeliveryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="approveDeliveryModalLabel"><i class="fas fa-check-circle"></i> Aprobar Repartidor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="approveDeliveryForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="fas fa-user-check fa-4x text-success"></i>
                    </div>
                    <p class="text-center fs-5">¬øEst√° seguro de aprobar al repartidor <strong id="approveDeliveryNombre"></strong>?</p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Al aprobar, el repartidor podr√° acceder a la plataforma y comenzar a aceptar pedidos.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times"></i> Cancelar</button>
                    <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> S√≠, Aprobar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para rechazar repartidor -->
<div class="modal fade" id="rejectDeliveryModal" tabindex="-1" aria-labelledby="rejectDeliveryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="rejectDeliveryModalLabel"><i class="fas fa-times-circle"></i> Rechazar Repartidor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="rejectDeliveryForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body">
                    <input type="hidden" name="section" value="delivery">
                    <p>¬øEst√° seguro de rechazar al repartidor <strong id="rejectDeliveryNombre"></strong>?</p>
                    <div class="mb-3">
                        <label for="motivoRechazoDelivery" class="form-label">Motivo del Rechazo <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="motivoRechazoDelivery" name="motivo" rows="4" 
                                  placeholder="Explique el motivo del rechazo (ej: Documentos incompletos, licencia vencida, etc.)" 
                                  required minlength="10"></textarea>
                        <div class="form-text">Este motivo ser√° enviado por email al repartidor.</div>
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> Se enviar√° un correo electr√≥nico al repartidor con el motivo del rechazo.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger"><i class="fas fa-times"></i> Rechazar y Notificar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para editar restaurante -->
<div class="modal fade" id="editRestaurantModal" tabindex="-1" aria-labelledby="editRestaurantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editRestaurantModalLabel"><i class="fas fa-edit"></i> Modificar Restaurante</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editRestaurantForm" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body">
                    <input type="hidden" id="editRestaurantId" name="id">
                    <div class="mb-3">
                        <label for="editRestaurantName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editRestaurantName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRestaurantLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editRestaurantLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRestaurantEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editRestaurantEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRestaurantPhone" class="form-label">Tel√©fono</label>
                        <input type="text" class="form-control" id="editRestaurantPhone" name="phone">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para cambiar estado de usuario -->
<div class="modal fade" id="toggleUserStatusModal" tabindex="-1" aria-labelledby="toggleUserStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="toggleUserStatusModalLabel">
                    <i class="fas fa-toggle-on" id="toggleUserStatusIcon"></i>
                    <span id="toggleUserStatusTitle">Cambiar Estado del Usuario</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i>
                    <span id="toggleUserStatusMessage">¬øEst√° seguro de cambiar el estado de este usuario?</span>
                </div>
                <p class="mb-0"><strong>Usuario:</strong> <span id="toggleUserStatusName">-</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="confirmToggleUserStatus">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para cambiar disponibilidad de repartidor -->
<div class="modal fade" id="toggleDeliveryAvailabilityModal" tabindex="-1" aria-labelledby="toggleDeliveryAvailabilityModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="toggleDeliveryAvailabilityModalLabel">
                    <i class="fas fa-motorcycle"></i>
                    <span>Cambiar Disponibilidad del Repartidor</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i>
                    <span id="toggleDeliveryAvailabilityMessage">¬øEst√° seguro de cambiar la disponibilidad de este repartidor?</span>
                </div>
                <p class="mb-0"><strong>Repartidor ID:</strong> <span id="toggleDeliveryAvailabilityId">-</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="confirmToggleDeliveryAvailability">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para cambiar estado de repartidor -->
<div class="modal fade" id="toggleDeliveryStatusModal" tabindex="-1" aria-labelledby="toggleDeliveryStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="toggleDeliveryStatusModalLabel">
                    <i class="fas fa-motorcycle"></i>
                    <span>Cambiar Estado del Repartidor</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i>
                    <span id="toggleDeliveryStatusMessage">¬øEst√° seguro de cambiar el estado de este repartidor?</span>
                </div>
                <p class="mb-0"><strong>Repartidor ID:</strong> <span id="toggleDeliveryStatusId">-</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="confirmToggleDeliveryStatus">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de √©xito para documentos subidos -->
<div class="modal fade" id="successDocumentModal" tabindex="-1" aria-labelledby="successDocumentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-success text-white border-0">
                <h5 class="modal-title" id="successDocumentModalLabel">
                    <i class="fas fa-check-circle me-2"></i>¬°√âxito!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="mb-3">
                    <i class="fas fa-file-upload fa-4x text-success"></i>
                </div>
                <h4 class="mb-3">Documentos Subidos Exitosamente</h4>
                <p class="text-muted mb-0">Los documentos del restaurante han sido cargados correctamente y est√°n disponibles para revisi√≥n.</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal" onclick="location.reload()">
                    <i class="fas fa-check"></i> Entendido
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de error para documentos -->
<div class="modal fade" id="errorDocumentModal" tabindex="-1" aria-labelledby="errorDocumentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-danger text-white border-0">
                <h5 class="modal-title" id="errorDocumentModalLabel">
                    <i class="fas fa-exclamation-circle me-2"></i>Error
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="mb-3">
                    <i class="fas fa-times-circle fa-4x text-danger"></i>
                </div>
                <h4 class="mb-3">Error al Subir Documentos</h4>
                <p class="text-muted mb-0" id="errorDocumentMessage">No se pudieron subir los documentos. Por favor, intente nuevamente.</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de √©xito para plato guardado -->
<div class="modal fade" id="successDishModal" tabindex="-1" aria-labelledby="successDishModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-success text-white border-0">
                <h5 class="modal-title" id="successDishModalLabel">
                    <i class="fas fa-check-circle me-2"></i>¬°√âxito!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="mb-3">
                    <i class="fas fa-utensils fa-4x text-success"></i>
                </div>
                <h4 class="mb-3" id="successDishTitle">Plato Guardado Exitosamente</h4>
                <p class="text-muted mb-0" id="successDishMessage">El plato ha sido guardado correctamente y est√° disponible en el men√∫.</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal">
                    <i class="fas fa-check"></i> Aceptar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de error para plato -->
<div class="modal fade" id="errorDishModal" tabindex="-1" aria-labelledby="errorDishModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-danger text-white border-0">
                <h5 class="modal-title" id="errorDishModalLabel">
                    <i class="fas fa-exclamation-circle me-2"></i>Error
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="mb-3">
                    <i class="fas fa-times-circle fa-4x text-danger"></i>
                </div>
                <h4 class="mb-3">Error al Guardar Plato</h4>
                <p class="text-muted mb-0" id="errorDishMessage">No se pudo guardar el plato. Por favor, intente nuevamente.</p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para cambiar estado de restaurante -->
<div class="modal fade" id="toggleRestaurantStatusModal" tabindex="-1" aria-labelledby="toggleRestaurantStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="toggleRestaurantStatusModalLabel">
                    <i class="fas fa-store" id="toggleRestaurantStatusIcon"></i>
                    <span id="toggleRestaurantStatusTitle">Cambiar Estado del Restaurante</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i>
                    <span id="toggleRestaurantStatusMessage">¬øEst√° seguro de cambiar el estado de este restaurante?</span>
                </div>
                <p class="mb-0"><strong>Restaurante ID:</strong> <span id="toggleRestaurantStatusId">-</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="confirmToggleRestaurantStatus">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para gestionar categor√≠as -->
<div class="modal fade" id="manageCategoriesModal" tabindex="-1" aria-labelledby="manageCategoriesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="manageCategoriesModalLabel">
                    <i class="fas fa-tags"></i> Gesti√≥n de Categor√≠as
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Formulario para crear categor√≠a -->
                    <div class="col-md-5">
                        <h6 class="mb-3"><i class="fas fa-plus-circle"></i> Crear Nueva Categor√≠a</h6>
                        <form action="/menuAdministrador/create-category" th:action="@{/menuAdministrador/create-category}" method="post">
                            <div class="mb-3">
                                <label for="categoryName" class="form-label">Nombre de Categor√≠a *</label>
                                <input type="text" class="form-control" id="categoryName" name="nombre" required>
                            </div>
                            <div class="mb-3">
                                <label for="categoryDescription" class="form-label">Descripci√≥n</label>
                                <textarea class="form-control" id="categoryDescription" name="descripcion" rows="2"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-plus"></i> Crear Categor√≠a
                            </button>
                        </form>
                    </div>
                    
                    <!-- Lista de categor√≠as existentes -->
                    <div class="col-md-7">
                        <h6 class="mb-3"><i class="fas fa-list"></i> Categor√≠as Existentes</h6>
                        <div class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Descripci√≥n</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="category : ${categories}">
                                        <td><strong th:text="${category.nombre}">Poller√≠a</strong></td>
                                        <td><small th:text="${category.descripcion}">Descripci√≥n</small></td>
                                        <td>
                                            <span th:class="${category.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${category.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group" aria-label="Acciones de categor√≠a">
                                                <!-- Bot√≥n Cambiar Estado -->
                                                <button type="button" 
                                                        class="btn btn-toggle"
                                                        th:classappend="${category.estado ? 'btn-success' : 'btn-secondary'}"
                                                        th:onclick="|toggleCategoryStatus(${category.codigo}, ${category.estado}, this)|"
                                                        th:title="${category.estado ? 'Desactivar categor√≠a' : 'Activar categor√≠a'}">
                                                    <i th:class="${category.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                </button>
                                                
                                                <!-- Bot√≥n Eliminar -->
                                                <button type="button" 
                                                        class="btn btn-toggle btn-danger"
                                                        th:data-id="${category.codigo}"
                                                        th:data-name="${category.nombre}"
                                                        onclick="deleteCategoryConfirm(this.getAttribute('data-id'), this.getAttribute('data-name'))"
                                                        title="Eliminar categor√≠a">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para cambiar estado de categor√≠a -->
<div class="modal fade" id="toggleCategoryStatusModal" tabindex="-1" aria-labelledby="toggleCategoryStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="toggleCategoryStatusModalLabel">
                    <i class="fas fa-tags"></i>
                    <span>Cambiar Estado de la Categor√≠a</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i>
                    <span id="toggleCategoryStatusMessage">¬øEst√° seguro de cambiar el estado de esta categor√≠a?</span>
                </div>
                <p class="mb-0"><strong>Categor√≠a ID:</strong> <span id="toggleCategoryStatusId">-</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="confirmToggleCategoryStatus">
                    <i class="fas fa-check"></i> Confirmar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para eliminar categor√≠a -->
<div class="modal fade" id="deleteCategoryModal" tabindex="-1" aria-labelledby="deleteCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteCategoryModalLabel">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Eliminar Categor√≠a</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger mb-3">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="deleteCategoryMessage">¬øEst√° seguro de eliminar esta categor√≠a? Esta acci√≥n no se puede deshacer.</span>
                </div>
                <p class="mb-2"><strong>Categor√≠a:</strong> <span id="deleteCategoryName">-</span></p>
                <p class="mb-0"><strong>ID:</strong> <span id="deleteCategoryId">-</span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteCategory">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para gestionar men√∫ del restaurante -->
<div class="modal fade" id="manageMenuModal" tabindex="-1" aria-labelledby="manageMenuModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div>
                    <h5 class="modal-title" id="manageMenuModalLabel">
                        <i class="fas fa-utensils"></i> Gesti√≥n de Men√∫
                    </h5>
                    <small id="manageMenuRestaurantName" class="d-block mt-1 opacity-75">Restaurante Daniela</small>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4" style="background-color: #f8f9fa;">
                <input type="hidden" id="manageMenuRestaurantId" value="">
                
                <!-- Informaci√≥n y bot√≥n agregar plato -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <p class="text-muted mb-0">
                        <i class="fas fa-info-circle"></i> Configure los platos y sus unidades de medida con sus precios
                    </p>
                    <button type="button" class="btn btn-danger" onclick="openAddDishModal()">
                        <i class="fas fa-plus-circle"></i> Agregar Plato
                    </button>
                </div>

                <!-- Banner informativo -->
                <div class="alert" style="background-color: #e3f2fd; border-left: 4px solid #2196F3; border-radius: 8px;">
                    <div class="d-flex align-items-start">
                        <i class="fas fa-info-circle" style="color: #2196F3; font-size: 1.5rem; margin-right: 15px; margin-top: 3px;"></i>
                        <div>
                            <h6 class="mb-2" style="color: #1565C0; font-weight: 600;">¬øPor qu√© cada unidad tiene su propio precio?</h6>
                            <p class="mb-0" style="color: #424242; font-size: 0.95rem;">
                                Cada unidad de medida representa una porci√≥n diferente del mismo plato. Por ejemplo, un "Ceviche Personal" tiene menos cantidad que una "Fuente Familiar", por lo tanto tienen precios diferentes. Esto te permite crear promociones espec√≠ficas para cada tama√±o.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Lista de platos del men√∫ -->
                <div id="menuDishesContainer">
                    <div class="card shadow-sm mb-3" style="border-radius: 12px; border: 1px solid #e0e0e0;">
                        <div class="card-header" style="background-color: white; border-bottom: 2px solid #f5f5f5; padding: 20px;">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1" style="color: #333; font-weight: 600;">Ceviche de Pescado</h5>
                                    <small class="text-muted">2 unidad(es) disponible(s) ‚Ä¢ Rango de precios: S/ 18.00 - S/ 65.00</small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-warning me-2" onclick="editDish(1)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDish(1)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 20px; background-color: #fafafa;">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="p-3" style="background-color: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span style="font-weight: 600; color: #555;">Personal</span>
                                            <span class="badge" style="background-color: #dc3545; font-size: 0.9rem; padding: 6px 12px;">S/ 18.00</span>
                                        </div>
                                        <small class="text-muted">Porci√≥n individual</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="p-3" style="background-color: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span style="font-weight: 600; color: #555;">Fuente Familiar</span>
                                            <span class="badge" style="background-color: #dc3545; font-size: 0.9rem; padding: 6px 12px;">S/ 65.00</span>
                                        </div>
                                        <small class="text-muted">Para 4-6 personas</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ejemplo de segundo plato -->
                    <div class="card shadow-sm mb-3" style="border-radius: 12px; border: 1px solid #e0e0e0;">
                        <div class="card-header" style="background-color: white; border-bottom: 2px solid #f5f5f5; padding: 20px;">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1" style="color: #333; font-weight: 600;">Pollo a la Brasa</h5>
                                    <small class="text-muted">3 unidad(es) disponible(s) ‚Ä¢ Rango de precios: S/ 15.00 - S/ 52.00</small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-warning me-2" onclick="editDish(2)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDish(2)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 20px; background-color: #fafafa;">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="p-3" style="background-color: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span style="font-weight: 600; color: #555;">1/4 de Pollo</span>
                                            <span class="badge" style="background-color: #dc3545; font-size: 0.9rem; padding: 6px 12px;">S/ 15.00</span>
                                        </div>
                                        <small class="text-muted">Cuarto de pollo</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3" style="background-color: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span style="font-weight: 600; color: #555;">1/2 Pollo</span>
                                            <span class="badge" style="background-color: #dc3545; font-size: 0.9rem; padding: 6px 12px;">S/ 28.00</span>
                                        </div>
                                        <small class="text-muted">Medio pollo</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3" style="background-color: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span style="font-weight: 600; color: #555;">Pollo Entero</span>
                                            <span class="badge" style="background-color: #dc3545; font-size: 0.9rem; padding: 6px 12px;">S/ 52.00</span>
                                        </div>
                                        <small class="text-muted">Pollo completo</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mensaje cuando no hay platos -->
                    <div id="noMenuItemsMessage" class="text-center py-5" style="display: none;">
                        <i class="fas fa-utensils" style="font-size: 4rem; color: #ccc;"></i>
                        <p class="text-muted mt-3">No hay platos en el men√∫ a√∫n. ¬°Agrega el primero!</p>
                    </div>
                </div>

                <!-- Bot√≥n de ejemplo de uso -->
                <div class="text-center mt-4">
                    <button type="button" class="btn btn-outline-primary" onclick="window.open('path/to/example', '_blank')">
                        <i class="fas fa-eye"></i> Ver Ejemplo de Uso
                    </button>
                </div>
            </div>
            <div class="modal-footer" style="background-color: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para agregar/editar plato -->
<div class="modal fade" id="addDishModal" tabindex="-1" aria-labelledby="addDishModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <div class="modal-header" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border-radius: 15px 15px 0 0;">
                <h5 class="modal-title" id="addDishModalLabel">
                    <i class="fas fa-plus-circle"></i> Agregar Nuevo Plato
                </h5>
                <button type="button" class="btn-close btn-close-white" onclick="closeAddDishModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4" style="background-color: #f8f9fa;">
                <form id="addDishForm">
                    <!-- Nombre del Plato -->
                    <div class="mb-4">
                        <label for="dishName" class="form-label fw-bold">
                            <i class="fas fa-utensils text-danger"></i> Nombre del Plato <span class="text-danger">*</span>
                        </label>
                        <input type="text" class="form-control form-control-lg" id="dishName" 
                               placeholder="Ej: Ceviche de Pescado" required
                               style="border-radius: 8px; border: 2px solid #dee2e6;">
                    </div>

                    <!-- Unidades de Medida -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label class="form-label fw-bold mb-0">
                                <i class="fas fa-balance-scale text-danger"></i> Unidades de Medida <span class="text-danger">*</span>
                            </label>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="addMeasurementUnit()">
                                <i class="fas fa-plus"></i> Agregar Unidad
                            </button>
                        </div>

                        <!-- Contenedor de unidades -->
                        <div id="measurementUnitsContainer">
                            <!-- Primera unidad por defecto -->
                            <div class="measurement-unit-item card mb-3 shadow-sm" style="border-radius: 10px; border: 2px solid #e0e0e0;">
                                <div class="card-body" style="background-color: white; border-radius: 10px;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0" style="color: #555;">Unidad #1</h6>
                                        <button type="button" class="btn btn-sm btn-danger" onclick="removeMeasurementUnit(this)" 
                                                style="border-radius: 50%; width: 36px; height: 36px; padding: 0; 
                                                       display: inline-flex; align-items: center; justify-content: center;
                                                       transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(220, 53, 69, 0.3);"
                                                onmouseover="this.style.transform='scale(1.15) rotate(15deg)'; this.style.boxShadow='0 4px 12px rgba(220, 53, 69, 0.5)';"
                                                onmouseout="this.style.transform='scale(1) rotate(0deg)'; this.style.boxShadow='0 2px 5px rgba(220, 53, 69, 0.3)';">
                                            <i class="fas fa-trash" style="font-size: 0.9rem;"></i>
                                        </button>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Nombre de la Unidad <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control unit-name" 
                                                   placeholder="Ej: Personal, 1/4, Familiar"
                                                   required style="border-radius: 8px;">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Precio Original (S/) <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control unit-price" 
                                                   placeholder="Ej: 18.00" step="0.01" min="0"
                                                   required style="border-radius: 8px;">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Descripci√≥n (opcional)</label>
                                            <input type="text" class="form-control unit-description" 
                                                   placeholder="Ej: Porci√≥n individual, Para 4-6 personas"
                                                   style="border-radius: 8px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Nota informativa -->
                        <div class="alert alert-info mt-3" style="border-radius: 8px; border-left: 4px solid #0dcaf0;">
                            <small>
                                <i class="fas fa-info-circle"></i> 
                                <strong>Nota:</strong> Cada unidad debe tener su propio precio ya que las porciones son diferentes
                            </small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="background-color: #f8f9fa; border-radius: 0 0 15px 15px;">
                <button type="button" class="btn btn-secondary" onclick="closeAddDishModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-danger" onclick="saveDish()">
                    <i class="fas fa-save"></i> Guardar Plato
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para gestionar administradores -->
<div class="modal fade" id="manageAdminsModal" tabindex="-1" aria-labelledby="manageAdminsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="manageAdminsModalLabel">
                    <i class="fas fa-users-cog"></i> Gesti√≥n de Usuarios del Sistema
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Formulario para crear administrador -->
                    <div class="col-md-5">
                        <h6 class="mb-3"><i class="fas fa-user-plus"></i> Crear Nuevo Usuario</h6>
                        <form action="/menuAdministrador/create-admin" th:action="@{/menuAdministrador/create-admin}" method="post">
                            <div class="mb-3">
                                <label for="adminName" class="form-label">Nombre *</label>
                                <input type="text" class="form-control" id="adminName" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="adminLastName" class="form-label">Apellido *</label>
                                <input type="text" class="form-control" id="adminLastName" name="lastName" required>
                            </div>
                            <div class="mb-3">
                                <label for="adminEmail" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="adminEmail" name="email" required>
                            </div>
                            
                            <!-- Selector de Rol -->
                            <div class="mb-3">
                                <label for="adminRol" class="form-label"><i class="fas fa-user-tag"></i> Rol *</label>
                                <select class="form-select" id="adminRol" name="codigoRol" required>
                                    <option value="">-- Selecciona un rol --</option>
                                    <option th:each="rol : ${roles}" 
                                            th:if="${rol.estado}"
                                            th:value="${rol.codigo}" 
                                            th:text="${rol.nombre + ' - ' + rol.descripcion}"
                                            th:data-rol-codigo="${rol.codigo}"
                                            th:data-rol-nombre="${rol.nombre}">
                                        Rol
                                    </option>
                                </select>
                                <small class="text-muted">Define los permisos del usuario en el sistema</small>
                                <div id="rolHelp" class="form-text mt-1"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="adminPassword" class="form-label">Contrase√±a *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="adminPassword" name="password" minlength="8" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('adminPassword', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <!-- El mensaje de requisitos se generar√° din√°micamente por JavaScript -->
                            </div>
                            <div class="mb-3">
                                <label for="adminPasswordConfirm" class="form-label">Confirmar Contrase√±a *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="adminPasswordConfirm" name="passwordConfirm" minlength="8" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('adminPasswordConfirm', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <!-- El mensaje de coincidencia se generar√° din√°micamente por JavaScript -->
                            </div>
                            <div class="mb-3">
                                <label for="adminPhone" class="form-label">Tel√©fono</label>
                                <input type="text" class="form-control" id="adminPhone" name="phone">
                            </div>
                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-user-plus"></i> Crear Usuario
                            </button>
                        </form>
                    </div>
                    
                    <!-- Lista de usuarios del sistema existentes -->
                    <div class="col-md-7">
                        <h6 class="mb-3"><i class="fas fa-list"></i> Usuarios del Sistema Registrados</h6>
                        <div class="table-responsive" style="max-height: 450px; overflow-y: auto;">
                            <table class="table table-hover table-sm">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Rol</th>
                                        <th>Estado</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="admin : ${adminUsers}">
                                        <td class="fw-bold" th:text="${admin.codigo}">1</td>
                                        <td>
                                            <div th:text="${admin.nombre + ' ' + admin.apellidoPaterno}">Nombre</div>
                                            <small class="text-muted" th:text="${admin.telefono != null ? admin.telefono : 'Sin tel√©fono'}">Tel</small>
                                        </td>
                                        <td>
                                            <small th:text="${admin.correoElectronico}">email@example.com</small>
                                        </td>
                                        <td>
                                            <span th:if="${admin.codigoRol == 1}" class="badge bg-danger">
                                                <i class="fas fa-crown"></i> ADMIN
                                            </span>
                                            <span th:if="${admin.codigoRol == 2}" class="badge bg-warning text-dark">
                                                <i class="fas fa-store"></i> RESTAURANTE
                                            </span>
                                            <span th:if="${admin.codigoRol == 3}" class="badge bg-info">
                                                <i class="fas fa-motorcycle"></i> REPARTIDOR
                                            </span>
                                        </td>
                                        <td>
                                            <span th:class="${admin.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                  th:text="${admin.estado ? 'Activo' : 'Inactivo'}">
                                                Activo
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-sm btn-outline-warning" 
                                                        th:onclick="'toggleUserStatus(' + ${admin.codigo} + ')'"
                                                        th:title="${admin.estado ? 'Desactivar' : 'Activar'}">
                                                    <i th:class="${admin.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr th:if="${adminUsers == null || adminUsers.isEmpty()}">
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="fas fa-inbox fa-2x mb-2"></i>
                                            <p class="mb-0">No hay usuarios del sistema registrados</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para gestionar roles del sistema -->
<div class="modal fade" id="manageRolesModal" tabindex="-1" aria-labelledby="manageRolesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="manageRolesModalLabel">
                    <i class="fas fa-user-shield me-2"></i> Gesti√≥n de Roles del Sistema
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row g-4">
                    <!-- Formulario para crear rol -->
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-plus-circle me-2"></i> Crear Nuevo Rol</h6>
                            </div>
                            <div class="card-body">
                                <form action="/menuAdministrador/role/create" th:action="@{/menuAdministrador/role/create}" method="post">
                                    <div class="mb-3">
                                        <label for="rolNombre" class="form-label fw-bold">
                                            <i class="fas fa-tag text-primary me-1"></i> Nombre del Rol *
                                        </label>
                                        <input type="text" class="form-control" id="rolNombre" name="nombre" 
                                               placeholder="Ej: Supervisor, Gerente..." required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="rolDescripcion" class="form-label fw-bold">
                                            <i class="fas fa-align-left text-primary me-1"></i> Descripci√≥n
                                        </label>
                                        <textarea class="form-control" id="rolDescripcion" name="descripcion" rows="2" 
                                                  placeholder="Describe las funciones de este rol..."></textarea>
                                    </div>
                                    
                                    <!-- Alerta informativa -->
                                    <div class="alert alert-info border-0 mb-3" style="background-color: #cfe2ff;">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-info-circle text-info me-2 mt-1"></i>
                                            <small>
                                                <strong>Nota:</strong> Los nuevos roles solo pueden tener permisos administrativos 
                                                (Usuarios del Sistema, Categor√≠as y Configuraci√≥n).
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <!-- Permisos del rol -->
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">
                                            <i class="fas fa-shield-alt text-success me-1"></i> Permisos de Acceso
                                        </label>
                                        <button type="button" class="btn btn-outline-primary w-100" onclick="abrirModalSeleccionPermisos()">
                                            <i class="fas fa-list-check me-2"></i>
                                            Seleccionar Permisos
                                            <span class="badge bg-primary ms-2" id="countPermisos">0</span>
                                        </button>
                                        <div id="selectedPermisosDisplay" class="mt-2 p-2 border rounded bg-light" style="min-height: 60px; max-height: 150px; overflow-y: auto;">
                                            <small class="text-muted">No hay permisos seleccionados</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Inputs ocultos para los permisos seleccionados -->
                                    <div id="hiddenPermisosContainer"></div>
                                    
                                    <button type="submit" class="btn btn-primary w-100 fw-bold">
                                        <i class="fas fa-plus me-2"></i> Crear Rol
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal para seleccionar permisos -->
                    <div class="modal fade" id="selectPermisosModal" tabindex="-1" aria-labelledby="selectPermisosModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="selectPermisosModalLabel">
                                        <i class="fas fa-shield-alt me-2"></i> Configurar Permisos del Rol
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" onclick="cerrarModalSeleccionPermisos()" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                                    
                                    <!-- Usuarios -->
                                    <div class="card mb-3 border-primary" th:if="${permisos.?[seccion == 'usuarios'].size() > 0}">
                                        <div class="card-header bg-primary bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllUsuarios" data-section="usuarios">
                                                <label class="form-check-label fw-bold text-primary" for="selectAllUsuarios">
                                                    <i class="fas fa-users-cog me-2"></i> Usuarios del Sistema
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'usuarios']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="usuarios">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-info me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Clientes - OCULTO para nuevos roles -->
                                    <!-- Solo roles del sistema pueden tener estos permisos -->
                                    
                                    <!-- Restaurantes - OCULTO para nuevos roles -->
                                    <!-- Solo roles del sistema pueden tener estos permisos -->
                                    
                                    <!-- Delivery - OCULTO para nuevos roles -->
                                    <!-- Solo roles del sistema pueden tener estos permisos -->
                                    
                                    <!-- Categor√≠as -->
                                    <div class="card mb-3 border-secondary" th:if="${permisos.?[seccion == 'categorias'].size() > 0}">
                                        <div class="card-header bg-secondary bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllCategorias" data-section="categorias">
                                                <label class="form-check-label fw-bold text-secondary" for="selectAllCategorias">
                                                    <i class="fas fa-tags me-2"></i> Categor√≠as
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'categorias']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="categorias">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-secondary me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Configuraci√≥n -->
                                    <div class="card mb-3 border-dark" th:if="${permisos.?[seccion == 'configuracion'].size() > 0}">
                                        <div class="card-header bg-dark bg-opacity-10">
                                            <div class="form-check">
                                                <input class="form-check-input select-all-section" type="checkbox" id="selectAllConfiguracion" data-section="configuracion">
                                                <label class="form-check-label fw-bold text-dark" for="selectAllConfiguracion">
                                                    <i class="fas fa-cogs me-2"></i> Configuraci√≥n
                                                </label>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'configuracion']}">
                                                    <div class="form-check">
                                                        <input class="form-check-input permiso-checkbox" type="checkbox" 
                                                               th:id="'modal_permiso_' + ${permiso.codigo}"
                                                               th:value="${permiso.codigo}"
                                                               th:data-nombre="${permiso.nombre}"
                                                               th:data-accion="${permiso.accion}"
                                                               data-section="configuracion">
                                                        <label class="form-check-label" th:for="'modal_permiso_' + ${permiso.codigo}">
                                                            <span class="badge bg-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                                            <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="cerrarModalSeleccionPermisos()">
                                        <i class="fas fa-times me-2"></i> Cancelar
                                    </button>
                                    <button type="button" class="btn btn-primary" id="confirmPermisos" onclick="cerrarModalSeleccionPermisos()">
                                        <i class="fas fa-check me-2"></i> Confirmar Selecci√≥n
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Continuar con el resto del modal de roles -->
                    
                    <!-- Lista de roles existentes -->
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-list-ul me-2"></i> Roles Registrados</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead style="background-color: #e9ecef;">
                                            <tr>
                                                <th class="text-center" style="width: 80px;">C√≥digo</th>
                                                <th>Nombre</th>
                                                <th>Descripci√≥n</th>
                                                <th class="text-center" style="width: 120px;">Permisos</th>
                                                <th class="text-center" style="width: 100px;">Estado</th>
                                                <th class="text-center" style="width: 200px;">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="rol : ${roles}">
                                                <td class="text-center">
                                                    <span class="badge rounded-pill bg-secondary fs-6" th:text="${rol.codigo}">1</span>
                                                </td>
                                                <td>
                                                    <strong class="text-primary" th:text="${rol.nombre}">ADMINISTRADOR</strong>
                                                </td>
                                                <td>
                                                    <small th:text="${rol.descripcion != null ? rol.descripcion : '-'}">Descripci√≥n</small>
                                                </td>
                                                <td class="text-center">
                                                    <button type="button" 
                                                            class="btn btn-sm btn-outline-primary view-permisos-btn"
                                                            onclick="verPermisosRolManual(this)"
                                                            th:data-rol-id="${rol.codigo}"
                                                            th:data-rol-nombre="${rol.nombre}"
                                                            th:if="${rol.permisos != null && !rol.permisos.isEmpty()}">
                                                        <i class="fas fa-shield-alt me-1"></i>
                                                        <span class="badge bg-primary rounded-pill" th:text="${rol.permisos.size()}">0</span>
                                                    </button>
                                                    <span th:if="${rol.permisos == null || rol.permisos.isEmpty()}" 
                                                          class="text-muted fst-italic"
                                                          title="Sin permisos asignados">
                                                        <i class="fas fa-lock"></i>
                                                    </span>
                                                </td>
                                                <td class="text-center">
                                                    <span th:class="${rol.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                                          th:text="${rol.estado ? 'Activo' : 'Inactivo'}">
                                                        Activo
                                                    </span>
                                                </td>
                                                <td class="text-center">
                                                    <div class="btn-group" role="group">
                                                        <!-- Bot√≥n Editar - Solo para roles personalizados -->
                                                        <button type="button" class="btn btn-sm btn-outline-info" 
                                                                th:if="${rol.codigo > 4}"
                                                                data-bs-toggle="modal" 
                                                                data-bs-target="#editRolModal"
                                                                th:data-id="${rol.codigo}"
                                                                th:data-nombre="${rol.nombre}"
                                                                th:data-descripcion="${rol.descripcion}"
                                                                th:onclick="'loadRolPermisos(' + ${rol.codigo} + ')'"
                                                                title="Editar">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        
                                                        <!-- Candado para roles del sistema -->
                                                        <button type="button" class="btn btn-sm btn-outline-secondary" 
                                                                th:if="${rol.codigo <= 4}"
                                                                disabled
                                                                title="Rol del sistema protegido - No editable">
                                                            <i class="fas fa-lock"></i>
                                                        </button>
                                                        
                                                        <!-- Bot√≥n Cambiar Estado - Solo para roles personalizados -->
                                                        <form th:action="@{/menuAdministrador/role/{id}/toggle-status(id=${rol.codigo})}" 
                                                              method="post" style="display: inline;"
                                                              th:if="${rol.codigo > 4}">
                                                            <button type="submit" class="btn btn-sm btn-outline-warning" 
                                                                    th:title="${rol.estado ? 'Desactivar' : 'Activar'}">
                                                                <i th:class="${rol.estado ? 'fas fa-toggle-on' : 'fas fa-toggle-off'}"></i>
                                                            </button>
                                                        </form>
                                                        
                                                        <!-- Bot√≥n Eliminar (solo para roles personalizados) -->
                                                        <form th:if="${rol.codigo > 4}" 
                                                              th:action="@{/menuAdministrador/role/{id}/delete(id=${rol.codigo})}" 
                                                              method="post" style="display: inline;"
                                                              onsubmit="return confirm('¬øEst√° seguro de eliminar este rol? Esta acci√≥n no se puede deshacer.');">
                                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                    
                                                    <!-- Indicador de rol del sistema -->
                                                    <div th:if="${rol.codigo <= 4}" class="mt-1">
                                                        <span class="badge bg-primary" title="Rol del sistema protegido">
                                                            <i class="fas fa-lock me-1"></i> Sistema
                                                        </span>
                                                    </div>
                                                </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Nota informativa -->
                <div class="alert alert-info border-0 mt-3 mb-0" style="background-color: #d1ecf1;">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle fs-4 me-3 text-info"></i>
                        <div>
                            <strong>Nota Importante:</strong> Los roles del sistema (c√≥digos 1-4) est√°n protegidos y no se pueden eliminar. 
                            Solo puedes editar su descripci√≥n y permisos.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cerrar
                </button>       
            </div>
        </div>
    </div>
</div>

<!-- Modal para editar rol -->
<div class="modal fade" id="editRolModal" tabindex="-1" aria-labelledby="editRolModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="editRolModalLabel">
                    <i class="fas fa-edit me-2"></i> Editar Rol
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editRolForm" method="post">
                <input type="hidden" id="editRolCodigo" value="">
                <div class="modal-body p-4">
                    <!-- Alerta para roles del sistema -->
                    <div class="alert alert-warning border-0 mb-3" id="editRolSystemAlert" style="display: none; background-color: #fff3cd;">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-shield-alt text-warning fs-4 me-3"></i>
                            <div>
                                <strong>‚ö†Ô∏è Rol del Sistema Protegido</strong>
                                <p class="mb-0 small">Este rol tiene configuraciones predefinidas. El nombre y permisos no pueden modificarse.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editRolNombre" class="form-label fw-bold">
                                    <i class="fas fa-tag text-primary me-1"></i> Nombre del Rol *
                                    <span class="badge bg-primary ms-2" id="editRolSystemBadge" style="display: none;">
                                        <i class="fas fa-lock me-1"></i>Protegido
                                    </span>
                                </label>
                                <input type="text" class="form-control" id="editRolNombre" name="nombre" required>
                            </div>
                            <div class="mb-3">
                                <label for="editRolDescripcion" class="form-label fw-bold">
                                    <i class="fas fa-align-left text-primary me-1"></i> Descripci√≥n
                                </label>
                                <textarea class="form-control" id="editRolDescripcion" name="descripcion" rows="4" 
                                          placeholder="Actualiza la descripci√≥n del rol..."></textarea>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-shield-alt text-success me-1"></i> Permisos de Acceso
                                </label>
                                <button type="button" class="btn btn-outline-success w-100" id="editPermisosBtn" data-bs-toggle="modal" data-bs-target="#editPermisosModal">
                                    <i class="fas fa-list-check me-2" id="editPermisosIcon"></i>
                                    <span id="editPermisosText">Modificar Permisos</span>
                                    <span class="badge bg-success ms-2" id="editCountPermisos">0</span>
                                </button>
                                <div id="editSelectedPermisosDisplay" class="mt-2 p-2 border rounded bg-light" style="min-height: 60px; max-height: 200px; overflow-y: auto;">
                                    <small class="text-muted">No hay permisos seleccionados</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Inputs ocultos para los permisos seleccionados en edici√≥n -->
                    <div id="editHiddenPermisosContainer"></div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary fw-bold">
                        <i class="fas fa-save me-2"></i> Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para editar permisos del rol -->
<div class="modal fade" id="editPermisosModal" tabindex="-1" aria-labelledby="editPermisosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="editPermisosModalLabel">
                    <i class="fas fa-shield-alt me-2"></i> Editar Permisos del Rol
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                
                <!-- Usuarios -->
                <div class="card mb-3 border-primary" th:if="${permisos.?[seccion == 'usuarios'].size() > 0}">
                    <div class="card-header bg-primary bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllUsuarios" data-section="usuarios">
                            <label class="form-check-label fw-bold text-primary" for="editSelectAllUsuarios">
                                <i class="fas fa-users-cog me-2"></i> Usuarios del Sistema
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'usuarios']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="usuarios">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-info me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Clientes -->
                <div class="card mb-3 border-success" th:if="${permisos.?[seccion == 'clientes'].size() > 0}">
                    <div class="card-header bg-success bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllClientes" data-section="clientes">
                            <label class="form-check-label fw-bold text-success" for="editSelectAllClientes">
                                <i class="fas fa-user-friends me-2"></i> Clientes
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'clientes']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="clientes">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-success me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Restaurantes -->
                <div class="card mb-3 border-warning" th:if="${permisos.?[seccion == 'restaurantes'].size() > 0}">
                    <div class="card-header bg-warning bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllRestaurantes" data-section="restaurantes">
                            <label class="form-check-label fw-bold text-warning" for="editSelectAllRestaurantes">
                                <i class="fas fa-utensils me-2"></i> Restaurantes
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'restaurantes']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="restaurantes">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-warning text-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery -->
                <div class="card mb-3 border-danger" th:if="${permisos.?[seccion == 'delivery'].size() > 0}">
                    <div class="card-header bg-danger bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllDelivery" data-section="delivery">
                            <label class="form-check-label fw-bold text-danger" for="editSelectAllDelivery">
                                <i class="fas fa-motorcycle me-2"></i> Repartidores
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'delivery']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="delivery">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-danger me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Categor√≠as -->
                <div class="card mb-3 border-secondary" th:if="${permisos.?[seccion == 'categorias'].size() > 0}">
                    <div class="card-header bg-secondary bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllCategorias" data-section="categorias">
                            <label class="form-check-label fw-bold text-secondary" for="editSelectAllCategorias">
                                <i class="fas fa-tags me-2"></i> Categor√≠as
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'categorias']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="categorias">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-secondary me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Configuracion -->
                <div class="card mb-3 border-dark" th:if="${permisos.?[seccion == 'configuracion'].size() > 0}">
                    <div class="card-header bg-dark bg-opacity-10">
                        <div class="form-check">
                            <input class="form-check-input edit-select-all-section" type="checkbox" id="editSelectAllConfiguracion" data-section="configuracion">
                            <label class="form-check-label fw-bold text-dark" for="editSelectAllConfiguracion">
                                <i class="fas fa-cogs me-2"></i> Configuraci√≥n
                            </label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6" th:each="permiso : ${permisos.?[seccion == 'configuracion']}">
                                <div class="form-check">
                                    <input class="form-check-input edit-permiso-checkbox" type="checkbox" 
                                           th:id="'edit_modal_permiso_' + ${permiso.codigo}"
                                           th:value="${permiso.codigo}"
                                           th:data-nombre="${permiso.nombre}"
                                           th:data-accion="${permiso.accion}"
                                           th:data-codigo="${permiso.codigo}"
                                           data-section="configuracion">
                                    <label class="form-check-label" th:for="'edit_modal_permiso_' + ${permiso.codigo}">
                                        <span class="badge bg-dark me-1" style="font-size: 0.75rem;" th:text="${permiso.accion}">Ver</span>
                                        <small th:text="${permiso.descripcion}">Descripci√≥n</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cancelar
                </button>
                <button type="button" class="btn btn-success" id="confirmEditPermisos" data-bs-dismiss="modal">
                    <i class="fas fa-check me-2"></i> Confirmar Cambios
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Continuacion de permisos ocultos antiguos eliminada -->
                
<!-- Cierre de modales antiguos de edicion -->

<!-- Modal para ver permisos de un rol -->
<div class="modal fade" id="viewPermisosModal" tabindex="-1" aria-labelledby="viewPermisosModalLabel" aria-hidden="true" style="z-index: 1060;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background-color: white; position: relative; z-index: 1061;">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="viewPermisosModalLabel">
                    <i class="fas fa-shield-alt me-2"></i> Permisos del Rol: <span id="viewRolNombre" class="fw-bold"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                <div id="permisosContent" class="row g-3">
                    <!-- Se llenar√° din√°micamente con JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cerrar
                </button>
                <button type="button" class="btn btn-success" id="editPermisosFromView">
                    <i class="fas fa-edit me-2"></i> Editar Permisos
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para listar categor√≠as (antiguo - mantener por compatibilidad) -->
<div class="modal fade" id="categoryListModal" tabindex="-1" aria-labelledby="categoryListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="categoryListModalLabel"><i class="fas fa-tags"></i> Lista de Categor√≠as</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Descripci√≥n</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="category : ${categories}">
                                <td th:text="${category.codigo}">1</td>
                                <td th:text="${category.nombre}">Poller√≠a</td>
                                <td th:text="${category.descripcion}">Descripci√≥n</td>
                                <td>
                                    <span th:class="${category.estado ? 'badge bg-success' : 'badge bg-danger'}"
                                          th:text="${category.estado ? 'Activo' : 'Inactivo'}">
                                        Activo
                                    </span>
                                </td>
                                <td>
                                    <form th:action="@{/menuAdministrador/category/{id}/toggle-status(id=${category.codigo})}" 
                                          method="post" style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-warning" title="Cambiar Estado">
                                            <i class="fas fa-toggle-on"></i>
                                        </button>
                                    </form>
                                    <form th:action="@{/menuAdministrador/category/{id}/delete(id=${category.codigo})}" 
                                          method="post" style="display: inline;"
                                          onsubmit="return confirm('¬øEst√° seguro de eliminar esta categor√≠a?');">
                                        <button type="submit" class="btn btn-sm btn-danger" title="Eliminar">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/theme-toggle.js}"></script>

<!-- ========================================
     VARIABLES THYMELEAF (Solo lo necesario)
     ======================================== -->
<script th:inline="javascript">
/*<![CDATA[*/

// Configuraci√≥n global con variables del servidor
window.ADMIN_CONFIG = {
    activeSection: /*[[${activeSection}]]*/ 'usuarios',
    permisos: /*[[${permisos}]]*/ []
};

// Mapear permisos para el sistema
try {
    var permisosFromServer = window.ADMIN_CONFIG.permisos;
    
    if (permisosFromServer && Array.isArray(permisosFromServer)) {
        window.todosLosPermisos = permisosFromServer.map(function(p) {
            return {
                codigo: p.codigo || 0,
                nombre: p.nombre || p.accion || 'Permiso',
                accion: p.accion || p.nombre || 'Permiso',
                descripcion: p.descripcion || '',
                seccion: p.seccion || 'general'
            };
        });
        console.log('Permisos cargados:', window.todosLosPermisos.length);
    } else {
        console.warn('No hay permisos disponibles del servidor');
        window.todosLosPermisos = [];
    }
} catch(error) {
    console.error(' Error procesando permisos:', error);
    window.todosLosPermisos = [];
}

/*]]>*/
</script>

<!-- ========================================
     SCRIPTS EXTERNOS (Funcionalidad modular)
     ======================================== -->
<script src="/js/admin.js"></script>
<script src="/js/admin-permisos.js"></script>
<script src="/js/admin-form-validation.js"></script>
<script src="/js/admin-menu-management.js"></script>

<!-- ========================================
     FUNCIONALIDAD DE SUBIDA DE DOCUMENTOS
     ======================================== -->
<script>
// Funci√≥n para previsualizar nombre de archivo seleccionado
function previewFileName(input) {
    const fileName = input.files[0]?.name;
    const statusElement = input.parentElement.querySelector('.upload-status-carta, .upload-status-sanidad, .upload-status-licencia');
    
    if (fileName && statusElement) {
        statusElement.classList.remove('d-none');
        statusElement.innerHTML = '<i class="fas fa-check-circle"></i> ' + fileName;
    }
}

// Funci√≥n para subir documentos del restaurante
function uploadDocuments() {
    const restaurantId = document.getElementById('uploadRestaurantId').value;
    
    if (!restaurantId) {
        alert('Error: No se ha seleccionado ning√∫n restaurante');
        return;
    }
    
    const formData = new FormData(document.getElementById('uploadDocumentsForm'));
    
    // Verificar que al menos un archivo haya sido seleccionado
    const files = formData.getAll('cartaRestaurante').concat(
        formData.getAll('carnetSanidad'),
        formData.getAll('licenciaFuncionamiento')
    ).filter(file => file.size > 0);
    
    if (files.length === 0) {
        alert('Por favor selecciona al menos un documento para subir');
        return;
    }
    
    // Mostrar loading
    const button = event.target;
    const originalText = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Subiendo...';
    
    fetch('/menuAdministrador/restaurant/' + restaurantId + '/upload-documents', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        button.disabled = false;
        button.innerHTML = originalText;
        
        if (data.success) {
            // Mostrar modal de √©xito
            const successModal = new bootstrap.Modal(document.getElementById('successDocumentModal'));
            successModal.show();
        } else {
            // Mostrar modal de error con mensaje personalizado
            document.getElementById('errorDocumentMessage').textContent = data.message || 'No se pudieron subir los documentos';
            const errorModal = new bootstrap.Modal(document.getElementById('errorDocumentModal'));
            errorModal.show();
        }
    })
    .catch(error => {
        button.disabled = false;
        button.innerHTML = originalText;
        console.error('Error:', error);
        
        // Mostrar modal de error
        document.getElementById('errorDocumentMessage').textContent = 'Error al subir documentos: ' + error.message;
        const errorModal = new bootstrap.Modal(document.getElementById('errorDocumentModal'));
        errorModal.show();
    });
}

// Cuando se abre el modal, cargar el ID del restaurante y documentos existentes
document.addEventListener('DOMContentLoaded', function() {
    const viewModal = document.getElementById('viewRestaurantModal');
    
    if (viewModal) {
        viewModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const restaurantId = button.getAttribute('data-id');
            const nombre = button.getAttribute('data-nombre');
            const razon = button.getAttribute('data-razon');
            const ruc = button.getAttribute('data-ruc');
            const email = button.getAttribute('data-email');
            const telefono = button.getAttribute('data-telefono');
            const direccion = button.getAttribute('data-direccion');
            
            // Actualizar informaci√≥n general
            document.getElementById('viewRestaurantNombre').textContent = nombre || '-';
            document.getElementById('viewRestaurantRazon').textContent = razon || '-';
            document.getElementById('viewRestaurantRuc').textContent = ruc || '-';
            document.getElementById('viewRestaurantEmail').textContent = email || '-';
            document.getElementById('viewRestaurantTelefono').textContent = telefono || '-';
            document.getElementById('viewRestaurantDireccion').textContent = direccion || '-';
            
            // Guardar ID para upload
            document.getElementById('uploadRestaurantId').value = restaurantId;
            
            // Cargar documentos existentes
            fetch('/menuAdministrador/restaurant/' + restaurantId + '/documents')
                .then(response => response.json())
                .then(data => {
                    console.log('Documentos cargados:', data);
                    
                    // Actualizar botones de visualizaci√≥n
                    const btnCarta = document.getElementById('btnVerCarta');
                    const btnSanidad = document.getElementById('btnVerSanidad');
                    const btnLicencia = document.getElementById('btnVerLicencia');
                    
                    if (data.CARTA_RESTAURANTE) {
                        btnCarta.dataset.ruta = data.CARTA_RESTAURANTE;
                        btnCarta.classList.remove('btn-outline-primary');
                        btnCarta.classList.add('btn-primary');
                    } else {
                        btnCarta.dataset.ruta = '';
                        btnCarta.classList.remove('btn-primary');
                        btnCarta.classList.add('btn-outline-primary');
                    }
                    
                    if (data.CarnetSanidad) {
                        btnSanidad.dataset.ruta = data.CarnetSanidad;
                        btnSanidad.classList.remove('btn-outline-primary');
                        btnSanidad.classList.add('btn-primary');
                    } else {
                        btnSanidad.dataset.ruta = '';
                        btnSanidad.classList.remove('btn-primary');
                        btnSanidad.classList.add('btn-outline-primary');
                    }
                    
                    if (data.LicenciaFuncionamiento) {
                        btnLicencia.dataset.ruta = data.LicenciaFuncionamiento;
                        btnLicencia.classList.remove('btn-outline-primary');
                        btnLicencia.classList.add('btn-primary');
                    } else {
                        btnLicencia.dataset.ruta = '';
                        btnLicencia.classList.remove('btn-primary');
                        btnLicencia.classList.add('btn-outline-primary');
                    }
                })
                .catch(error => {
                    console.error('Error cargando documentos:', error);
                });
        });
    }
});
</script>

<!-- =====================================================
     üí∞ MODAL: CONFIGURAR COMISI√ìN
     ===================================================== -->
<div class="modal fade" id="configComisionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">
                    <i class="fas fa-cog"></i> Configurar Comisi√≥n de la Plataforma
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> La comisi√≥n se aplica sobre el subtotal de cada pedido (sin incluir el costo de delivery)
                </div>
                
                <div class="mb-3">
                    <label for="nuevoPorcentaje" class="form-label">
                        <i class="fas fa-percentage"></i> Porcentaje de Comisi√≥n
                    </label>
                    <div class="input-group">
                        <input type="number" 
                               class="form-control" 
                               id="nuevoPorcentaje" 
                               min="0" 
                               max="100" 
                               step="0.01" 
                               value="5.00"
                               placeholder="Ej: 5.00">
                        <span class="input-group-text">%</span>
                    </div>
                    <small class="text-muted">Ingrese un valor entre 0 y 100</small>
                </div>
                
                <div class="card bg-light border-0">
                    <div class="card-body">
                        <h6><i class="fas fa-calculator"></i> Simulaci√≥n:</h6>
                        <p class="mb-1">Con un subtotal de <strong>S/ 100.00</strong>:</p>
                        <ul class="list-unstyled mb-0">
                            <li>‚Ä¢ Comisi√≥n FooDIx: <strong class="text-success" id="simulacionComision">S/ 5.00</strong></li>
                            <li>‚Ä¢ Monto restaurante: <strong id="simulacionRestaurante">S/ 95.00</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-warning" onclick="actualizarComision()">
                    <i class="fas fa-save"></i> Guardar Configuraci√≥n
                </button>
            </div>
        </div>
    </div>
</div>

<!-- =====================================================
     üí∞ SCRIPT: GANANCIAS
     ===================================================== -->
<script>
// Bandera para cargar datos solo una vez
let gananciasYaCargadas = false;

// Cargar datos de ganancias al mostrar la secci√≥n
document.addEventListener('DOMContentLoaded', function() {
    // Interceptar cambio a secci√≥n de ganancias
    const originalShowSection = window.showSection;
    window.showSection = function(sectionName) {
        originalShowSection(sectionName);
        
        if (sectionName === 'ganancias' && !gananciasYaCargadas) {
            cargarResumenGanancias();
            cargarHistorialGanancias();
            gananciasYaCargadas = true;
        }
    };
    
    // Simulaci√≥n en tiempo real al cambiar porcentaje
    const inputPorcentaje = document.getElementById('nuevoPorcentaje');
    if (inputPorcentaje) {
        inputPorcentaje.addEventListener('input', function() {
            const porcentaje = parseFloat(this.value) || 0;
            const subtotal = 100;
            const comision = subtotal * (porcentaje / 100);
            const montoRestaurante = subtotal - comision;
            
            document.getElementById('simulacionComision').textContent = 'S/ ' + comision.toFixed(2);
            document.getElementById('simulacionRestaurante').textContent = 'S/ ' + montoRestaurante.toFixed(2);
        });
    }
});

/**
 * Obtener token JWT del localStorage
 */
function getAuthToken() {
    return localStorage.getItem('jwtToken') || '';
}

/**
 * Cargar resumen de ganancias
 */
function cargarResumenGanancias() {
    // Mostrar indicador de carga
    document.getElementById('gananciasTotales').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('gananciasMes').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('gananciasHoy').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('porcentajeComision').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    
    fetch('/menuAdministrador/api/ganancias/resumen', {
        headers: {
            'Authorization': 'Bearer ' + getAuthToken()
        }
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('gananciasTotales').textContent = 'S/ ' + parseFloat(data.gananciasTotales).toFixed(2);
                document.getElementById('gananciasMes').textContent = 'S/ ' + parseFloat(data.gananciasMes).toFixed(2);
                document.getElementById('gananciasHoy').textContent = 'S/ ' + parseFloat(data.gananciasHoy).toFixed(2);
                document.getElementById('porcentajeComision').textContent = parseFloat(data.porcentajeComision).toFixed(2) + '%';
                document.getElementById('nuevoPorcentaje').value = parseFloat(data.porcentajeComision).toFixed(2);
                
                // Actualizar mes actual
                const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                const mesActual = meses[new Date().getMonth()];
                document.getElementById('mesActual').textContent = mesActual + ' ' + new Date().getFullYear();
            }
        })
        .catch(error => {
            console.error('Error cargando resumen:', error);
            document.getElementById('gananciasTotales').textContent = 'Error';
            document.getElementById('gananciasMes').textContent = 'Error';
            document.getElementById('gananciasHoy').textContent = 'Error';
            document.getElementById('porcentajeComision').textContent = 'Error';
        });
}

/**
 * Cargar historial de ganancias
 */
function cargarHistorialGanancias() {
    const tbody = document.getElementById('historialGanancias');
    
    // Mostrar mensaje de carga
    tbody.innerHTML = `
        <tr>
            <td colspan="6" class="text-center">
                <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                <p class="mt-2 mb-0">Cargando historial...</p>
            </td>
        </tr>
    `;
    
    fetch('/menuAdministrador/api/ganancias/historial', {
        headers: {
            'Authorization': 'Bearer ' + getAuthToken()
        }
    })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.ganancias) {
                if (data.ganancias.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                <i class="fas fa-inbox"></i> No hay registros de ganancias a√∫n
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = data.ganancias.map(g => {
                    const fecha = new Date(g.fechaRegistro);
                    const fechaFormateada = fecha.toLocaleDateString('es-PE', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    return `
                        <tr>
                            <td><strong>#${g.codigoPedido}</strong></td>
                            <td>${fechaFormateada}</td>
                            <td>S/ ${parseFloat(g.subtotal).toFixed(2)}</td>
                            <td><span class="badge bg-warning">${parseFloat(g.porcentajeAplicado).toFixed(2)}%</span></td>
                            <td><strong class="text-success">S/ ${parseFloat(g.comision).toFixed(2)}</strong></td>
                            <td>S/ ${parseFloat(g.montoRestaurante).toFixed(2)}</td>
                        </tr>
                    `;
                }).join('');
            }
        })
        .catch(error => {
            console.error('Error cargando historial:', error);
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center text-danger">
                        <i class="fas fa-exclamation-triangle"></i> Error al cargar datos
                    </td>
                </tr>
            `;
        });
}

/**
 * Actualizar comisi√≥n
 */
function actualizarComision() {
    const porcentaje = parseFloat(document.getElementById('nuevoPorcentaje').value);
    
    if (isNaN(porcentaje) || porcentaje < 0 || porcentaje > 100) {
        alert('El porcentaje debe estar entre 0 y 100');
        return;
    }
    
    if (!confirm(`¬øEst√° seguro de cambiar la comisi√≥n a ${porcentaje.toFixed(2)}%?\n\nEsto afectar√° a todos los pedidos nuevos.`)) {
        return;
    }
    
    const btn = event.target;
    const textoOriginal = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
    
    fetch('/menuAdministrador/api/ganancias/actualizar-comision?porcentaje=' + porcentaje, {
        method: 'POST',
        headers: {
            'Authorization': 'Bearer ' + getAuthToken()
        }
    })
        .then(response => response.json())
        .then(data => {
            btn.disabled = false;
            btn.innerHTML = textoOriginal;
            
            if (data.success) {
                alert('‚úÖ Comisi√≥n actualizada correctamente');
                
                // Cerrar modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('configComisionModal'));
                modal.hide();
                
                // Recargar datos
                cargarResumenGanancias();
            } else {
                alert('‚ùå ' + (data.message || 'Error al actualizar comisi√≥n'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            btn.disabled = false;
            btn.innerHTML = textoOriginal;
            alert('‚ùå Error de conexi√≥n');
        });
}
</script>

<!-- =====================================================
     üöö SCRIPT: MODALES DE REPARTIDORES Y RESTAURANTES
     ===================================================== -->
<script>
// Modal para aprobar restaurante
document.addEventListener('DOMContentLoaded', function() {
    const approveRestaurantModal = document.getElementById('approveRestaurantModal');
    
    if (approveRestaurantModal) {
        approveRestaurantModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const restaurantId = button.getAttribute('data-id');
            const restaurantName = button.getAttribute('data-nombre');
            
            // Actualizar el nombre del restaurante en el modal
            document.getElementById('approveRestaurantNombre').textContent = restaurantName;
            
            // Actualizar la acci√≥n del formulario
            const form = document.getElementById('approveRestaurantForm');
            form.action = '/menuAdministrador/restaurant/' + restaurantId + '/approve';
        });
    }
    
    // Modal para aprobar repartidor
    const approveModal = document.getElementById('approveDeliveryModal');
    
    if (approveModal) {
        approveModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const deliveryId = button.getAttribute('data-id');
            const deliveryName = button.getAttribute('data-name');
            
            // Actualizar el nombre del repartidor en el modal
            document.getElementById('approveDeliveryNombre').textContent = deliveryName;
            
            // Actualizar la acci√≥n del formulario
            const form = document.getElementById('approveDeliveryForm');
            form.action = '/menuAdministrador/repartidor/' + deliveryId + '/approve';
        });
    }
    
    // Modal para rechazar repartidor
    const rejectModal = document.getElementById('rejectDeliveryModal');
    
    if (rejectModal) {
        rejectModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const deliveryId = button.getAttribute('data-id');
            const deliveryName = button.getAttribute('data-name');
            
            // Actualizar el nombre del repartidor en el modal
            document.getElementById('rejectDeliveryNombre').textContent = deliveryName;
            
            // Actualizar la acci√≥n del formulario
            const form = document.getElementById('rejectDeliveryForm');
            form.action = '/menuAdministrador/repartidor/' + deliveryId + '/reject';
        });
    }
});
</script>

<!-- JWT Helper para cerrar sesi√≥n -->
<script src="/js/jwt-helper.js"></script>

</body>
</html>
